---
title: "Une part des salaires dans la VA élévée en 2025 en France"
subtitle: "Comparaisons internationales de 30 ans de partage de la valeur ajoutée"
author:
  - name: "Xavier Timbeau" 
    email: "xavier.timbeau@sciencespo.fr"
    affiliation: OFCE, Sciences Po Paris
    affiliation-url: "http://www.ofce.fr"
    orcid: "0000-0002-6198-5953"
editor: visual
date: "2025-09-08"
date-modified: now
wp: 23
annee: 2025
bibliography: references.bib
echo: false
message: false
warning: false
keep-md: false
abstract: "On explore différentes façons de calculer la notion de part des salaires dans la valeur ajoutée. Le concept privilégié est celui de la part des salaires *corrigés de la non salarisation* dans la valeur ajoutée *nette de la consommation de capital fixe* des branches *marchandes hors services immobiliers*. Il peut être calculé pour les pays européens. Il fait apparaître une position singulière de la France où la part des salaires est plus élevé et s'est accrue de façon importante. Bien que plus fragile empiriquement, le calcul de rendement net d'impôts du capital productif confirme ce diagnostic particulerement préoccupant pour le tissu productif français. L'ensemble des éléments présentés est reproductible à partir des codes fournis."
citation:
  type: article-journal
  container-title: "Document de travail de l'OFCE"
  issue: 2025-23
  url: https://xtimbeau.github.io/travail/
filters:
  - wordcount
format:
  wp-html: default
  wp-pdf:
    output-file: "wp-ofce-2025-23 part des salaires dans la va.pdf"
crossref:
  custom:
    - key: apptbl
      kind: float
      reference-prefix: Tableau A
      space-before-numbering: false
      latex-env: apptbl
      latex-list-of-file-extension: lost
      latex-list-of-description: Tableaux annexes
    - key: appfig
      kind: float
      reference-prefix: Graphique A
      space-before-numbering: false
      latex-env: appfig
      latex-list-of-file-extension: lost
      latex-list-of-description: Graphiques annexes
apptbl-cap-location: top
appfig-cap-location: top
thanks: "Je remercie chaleureusement Elliot Aurissergues, François Geerolf et Eric Heyer pour leurs remarques pertinentes et stimulantes. Elles m'ont amené à aller plus loin dans la complexité des concepts et dans l'exploration des données. La confusion qui en découle est de ma seule responsabilité. "
---

```{r, include=FALSE}
ofce::init_qmd()
P6 <- source_data("R/nace.r")$pays1 

options(ofce.tabsetize.pdf = "one")
if(knitr::is_html_output()) {
  set_theme(theme_ofce(
    base_size = 10,
    marquee=TRUE,
    axis.line.y = element_blank(),
    legend.position = "bottom",
    legend.justification = "center")) } else { 
      set_theme(theme_ofce(
        base_size = 8,
        marquee=TRUE,
        legend.position = "bottom",
        legend.justification = "center")) }
```

::: aside
[{{wordcount}} mots]{style="font-size: 0.7rem; color: grey; font-style: italic;"}
:::

## Du partage de la VA au partage des richesses

L'analyse du partage de la valeur ajoutée (@fig-psal) est au cœur des débats sur la redistribution des richesses (voir notamment @hurlin1996, @timbeau2002, @cotis2009, @husson2010, @askenazy2012, @piton2019, @cette2019, @timbeau2025, @tresor2025). Un indicateur souvent retenu est celui de la part des salaires dans la valeur ajoutée. Nous discutons ici de la construction de cet indicateur et de sa comparabilité entre pays.

```{r, results="asis"}
#| label: fig-psal
#| fig-asp: 0.85
#| fig-cap: Part des salaires dans la VA nette

champs  <- c("md" = "Marchand", "mdhifi" = "Marchand hors immobilier et services financiers",
            "mdhi"= "Marchand hors services immobiliers", 
            "mdhim"= "Marchand hors imm. des ménages (L68A)", 
            "mdhfi"= "Marchand hors services financiers", 
            "tb" = "Toutes branches (marchandes et non marchandes)")
naq <- source_data("R/vaq.r")$naa |> 
  filter(geo %in% P6) |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)} 
    {champs[champ]}
    Part des salaires dans la VAN : {round(psal*100,1)}%")) |>
  mutate(geo = factor(geo, P6))

date <- sourcoise::sourcoise_meta("R/vaq.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

labels_champ = c(tb = "Ttes branches", md="Marchand", mdhifi = "Marchand hors imm.&fin.",
                 mdhim = "Marchand hors L68A (ménages)",
                 mdhi = "Marchand hors imm.")

psal <- imap(
  c("hors services immobiliers (-L)" = "mdhi", 
    "Marchand" = "md",
    "hors loyers imputés (-L68A)" = "mdhim"),
  ~ggplot(naq |> filter(champ == .x)) +
    aes(x=time, y=psal, col = geo, group = geo) +
    geom_line(color = "grey80", layout = "fixed", linewidth = 0.2) +
    geom_line_interactive(
      aes(
        tooltip = "Part des salaires dans la VAN,<br>corrigée de la non salarisation,<br>{.y}" |> glue(),
        data_id = champ),
      linewidth = 0.5) +
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = geo),
      size = 1, stroke = 0.5, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d) +
  guides( fill = "none", color = "none",
          linetype = guide_legend(nrow = 1),
          alpha = guide_legend(nrow = 1)) + 
  scale_y_continuous(
    labels = scales::label_percent(1), 
                     breaks = scales::pretty_breaks(5),
                     limits = c(.65, .95)) +
  scale_color_pays(format = "eurostat") +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}, code à github.com/xtimbeau/travail/R/vaq.r.",
    champ = "Branches marchandes {.y}.",
    note = "La CCF ou les impôts nets de subventions proviennent des comptes annuels, jusqu'en 2023 ou 2024 selon les pays, extrapolée au delà (voir tableau A1). Le partage de la valeur ajoutée pour les tous derniers points évolue donc comme le partage dans la valeur ajoutée brute. Les traits colorés correspondent à chaque pays, les traits fins gris rappellent les autres pays.") ) 

tabsetize(psal, r = 1.25)
```

```{r, results="asis"}
margin_download(naq |> select(-tooltip))
```

### Du bon concept de part des salaires

Trois points sont importants pour disposer du bon concept (voir @reis2022 pour une discussion et une revue de littérature sur ce point) :

-   Corriger des non salariés et leur imputer une masse salariale. La correction habituelle consiste à affecter aux non salariés le même salaire que les salariés (généralement de la même branche) ; c'est ainsi que traitent la question @cette2019 et @tresor2025. Nous procédons à cette correction (appelée correction pas les effectifs) au niveau 21 branches de la NACE rev 2. Nous proposons une alternative en utilisant la mesure du revenu mixte (dite correction par le revenu mixte), parce que l'affectation d'un salarie égal aux non salariés et aux salariés par branches conduit à affecter une masse salariale équivalente supérieure au revenu mixte des non salariés[^1]. En France, le revenu mixte (des non-salariés donc) est passé de 30% de la masse salariale (autant pour le ratio des effectifs) au début des années 1970 à un peu moins de 10% (presque 15% pour les effectifs) en 2024. Malheureusement, le revenu mixte par branche n'est pas diffusé systématiquement par les Etats membres de l'UE. Ces corrections modidient singificativement la part des salaires dans la valeur ajoutée, suivant la méthode, parce que non seulement la part des non salariés et de leur revenu mixte varie dans le temps, de façon différente par un effet de structure (moins d'agriculteurs) et de nature (les non salariés sont moins rémunérés aujourd'hui), de façon différente par pays (@fig-psalcnc et voir les annexes D et G consacrées à ce point).

-   Définir le champ considéré. Il est plus facile de faire le calcul au niveau le plus agrégé, mais ce champ inclut les branches non marchandes dans lesquelles la notion de prix et donc de valeur ajoutée est parfois conventionnelle. Parmi les branches marchandes, la branches des services immobiliers est problématique parce qu'elle prend en compte la valeur ajoutée des ménages au travers des services immobiliers qui sont pour part auto produit (les loyers imputés aux propriétaires) et pour part produits par les ménages pour d'autres ménages (les propriétaires bailleurs). Suivant les pays ou les périodes, le nombre de propriétaires occupants peut être très différent (@cette2019 fait ce point que @tresor2025 semble ignorer). Mais le vrai problème est que le partage de la valeur ajoutée n'a ici pas de sens dansle cas d'un loyer imputé ou d'un propriétaire bailleur. La consommation de services immobiliers par les ménages représentait en France en 2024 un peu moins de 300 milliards d'euros soit aprroximativement `r round(300/1666*100)`% de la valeur ajoutée brute hors services immobilier. On comprend donc que ce point n'est pas du tout négigeable. La notion privilégiée est donc celle de partage de la valeur ajoutée dans les branches marchandes hors services immobiliers ou, de façon plus précise, en enlevant de la valeur ajoutée marchande la branche "services immobiliers (L)" (@appfig-psalcompote, @fig-structbranche). Omettre les services immobiliers pose cependant un problème, parce que les loyers versés par les entreprises à leurs bailleurs sont souvent un prix de transfert et non un prix de marché. C'est donc un élément qui peut être utilisé comme véhicule pour de l'otpimisation fiscale, d'autant plus que la fiscalité immobilière peut être avantageuse. Nous explorons cette dimension dans la @sec-immobilier en particulier pour la France.

-   Utiliser la notion de valeur ajoutée nette (de la consommation de capital fixe, la CCF) plutôt que brute. Rappelons que la valeur ajoutée nette est construite en ôtant de la valeur ajoutée brute la consommation de capital fixe. Cette dernière notion découle de l'application de tables de mortalité à un inventaire permanent des investissements non financiers (i.e. les investissements physiques mais aussi ceux en logiciels ou en base de données ainsi que les investissements intangibles comme les marques). En traitant les investissements comme une consommation intermédiaire mesurée par leur amortissement physique ou fiscal, on est plus proche de la réalité du processus productif. Lorsque le taux de dépréciation du capital varie, par des changement dans les tables de mortalité, des changements dans la composition du capital ou des changements dans la structure par branche de l'économie, la CCF rapportée à la valeur ajoutée varie et modifie donc la perception des évolutions du partage de la valeur ajoutée. La notion de valeur ajoutée nette est meilleure pour des comparaisons dans l'espace ou dans le temps. Comme pour la correction pour les non salariés, la prise en compte de la valeur ajoutée nette modifie dans le temps et dans l'espace la part des salaires dans la valeur ajoutée (@fig-psalnetbrut). Ce point est signalé par @tresor2025, mais les auteurs ont préféré le concept de valeur ajoutée brute pour des raisons de comparabilité entre études – au détriment de la comparabilité dans le temps et dans l'espace.

[^1]: Merci à E. Aurissergues pour m'avoir pointé cette anomalie.

Le concept que nous privilégions est donc défini comme suit (où, pour chaque branche $D1_b$ est la masse salariale chargée, $B1G_b$ la valeur ajoutée brute, $P51C_b$ la $CCF_b$, les trois notions en euros aux prix courants et $ns_b$ et $sal_b$ les effectifs en personne ou le revenu mixte par branche)[^2] :

[^2]: @cette2019 utilisent une définition plus large des branches non marchande en incluant les branches R, T et U.

$$
s_{net, n.s., -LOPQ}  = \frac{\sum_{b\in{TT-LOPQ}}{D1_b*(1+ns_b/sal_b)}}{\sum_{b\in{TT-LOPQ}}{B1G_b - P51C_b}}
$$

La part des salaires dans la valeur ajoutée nette est croissante en France (@fig-psal) (de 10 points de 1998 à 2025), comme en Espagne (de 9 points). Elle atteint en France le niveau le plus élevé des pays sélectionnés (correction des non salariés par les effectifs), pour autant que l'on puisse comparer entre pays. Ce résultat constraste avec les évaluations récents de @cette2019 et @tresor2025.

Théoriquement[^3], l'évolution de part des salaires dans la valeur ajoutée dépend de la fonction de production agrégée (ce qui suppose qu'elle existe). Si l'élasticité de substitution entre le capital et la travail est unitaire alors on s'attend à ce que le partage soit indépendant du prix relatif du travail et du capital. La part des salaires est alors uniquement déterminée par la forme de la fonction de production et devrait converger dans tous les pays vers une valeur semblable, par diffusion de la technologie. Une structure de l'économie par branche différente peut cependant se traduire par des parts différentes d'un pays à l'autre.

[^3]: @cette2019 propose une modélisation simple des principaux déterminants du partage de la valeur ajoutée sur la base d'une fonction de production. @reis2022 étend l'analyse en équilibre néokeynéisien.

L'élasticité estimée généralement, au moins à moyen terme, est sensiblement inférieure à 1, en tout cas sur données macroéconomique. Cela implique qu'une hausse du prix du travail relativement par au capital se traduit par une hausse de la part du travail dans la valeur ajoutée – la réciproque étant bien entendu vraie si c'est le capital qui est relativement plus cher. Cela peut conduire à des variations plus persistantes de la part des salaires dans la valeur ajoutée, mais ces variations doivent reproduire celles des prix relatifs.

La part des salaires dans la valeur ajoutée est la plus basse aux Pays-Bas et est sur une pente décroissante depuis plus de 20 ans, alors qu'elle semble stable en Belgique et en Allemagne. L’Italie affiche une variabilité temporelle importante, avec un pic de la part des salaires dans la valeur ajoutée en 2013, puis une franche décroissance (de plus de 13 points) interrompue dans la période récente suite à la période d'inflation et la forte relance budgétaire.

En France, la hausse est franche après la crise financière de 2008, suivant une période de grande stabilité de 1995 à 2007. Cette hausse peut découler d'un effet de structure sectorielle, mais le @fig-salaires indique une autre singularité française. Contrairement à de nombreux pays, les salaires réels sont restés sur une pente croissante, interrompue par la phase d'inflation à partir de la fin de l'année 2021, alors que dans les 5 autres pays, 2008 marque une cassure dans la progression de salaires réels.

Depuis 2018, en France, la part des salaires est stabilisée, à un haut niveau (@fig-psal). L'inflation et le retard d'ajustement des salaires sur l'inflation explique probablement cette trajectoire. On observe des mouvements comparables dans d'autres pays, bien que plus violent en Allemagne ou en Italie par exemple.

Au début des années 2000, deux pays se distinguaient des autres (l'Espagne et l'Italie) par une part des salaires plus faibles. L'écart avec l'Allemagne atteignait alors plus de 15 points. En généralisant l'approche aux pays de l'Union Européenne, on peut en partie confirmer cette hypothèse (@fig-psaleu). Les pays qui ont connu un développement rapide, et donc des niveaux d'investissement élevés, on eu des parts des salaires basses (La Bulgarie, la Tchéquie, la Grèce par exemple). Mais ce n'est pas une observation systématique : certains pays moins développés ont eu par le passé une part très élevée des salaires dans la valeur ajouté, témoignant peut être de modes de formation des salaires et d'inflation particulier et hérités du passé. Cependant, comme le suggèrent la position singulière de quelques petits pays, parmi lesquels l'Irlande, le Luxembourg, Malte, Chypre ou les Pays-Bas dans une certaine mesure, c'est peut être du côté du déplacement de la base imposable des profits (optimisation fiscale), des prix de transferts et d'une position très particulière dans la chaîne de valeur qu'il faut aller chercher l'explication de très faibles parts des salaires dans la valeur ajoutée.

```{r, results="asis"}
#| label: fig-psaleu
#| fig-asp: 0.85
#| fig-cap: Part des salaires dans la VA nette 1995 et 2025

psaleu <- source_data("R/ggvanettebrute.r")
tabsetize(psaleu$gg)
```

```{r, results="asis"}
margin_download(psaleu$data)

```

### Rendement finanicer du capital productif : la France au plus bas

La construction d'un taux de rendement financier du capital est sans doute assez fragile parce qu'il faut ajouter à l'évaluation du partage de la valeur ajoutée une estimation des impôts payés (notamment l'impôt sur les sociétés) et une évaluation du stock de capital (voir @sec-profits pour la méthode). En utilisant les données de stock de capital productif le diagnostic présenté sur le @fig-psal est confirmé par le @fig-rp.

Le choix du champ est assez important pour conserver une cohérence entre numérateur et le dénominateur. Pour le champ hors immobilier, le profit net et le stock de cpaital excluent toutes les activités immobilières parce que dans la plupart des pays (Allemagne, France, Italie) seule la branche immobilière détient des actifs de type logement ($N111N$ dans la nomenclature de la NACE rev2). Dans quelques pays, une part minoritaire de la valeur du stock de logements est détenue par d'autres branches (F, K, O, Q, R, S en Espagne (15%) ou en Belgique (0,5%); K au Pays-Bas (5%)) que la branche services immobiliers -- ce qui suggère que la convention branche/secteur n'est pas complètement suivie ou a été interprétée assez librement.

La France y occupe une position singulière avec un rendement du capital productif particulièrement faible et décroissant depuis le début des années 2000 alors qu'il est constant dans beaucoup de pays ou même croissant comme aux Pays-Bas. Les politiques de l'offre successives depuis le choc fiscal de Nicolas Sarkozy, le pacte pour la croissance, la compétitivité et l'emploi de François Hollande en 2012 ou encore les politiques d'attractivité, en particulier fiscales, engagées par Emmanuel Macron depuis 2017 n'ont apparemment pas changé grand chose à cette dégradation continue. Tout au plus, on peut y associer la relative stabilisation du taux de rendement net en France (@fig-rp) à partir de 2017.

Une explication possible de la dégradation du rendement du capital productif est à chercher du côté de son accroissement aux Pays-Bas – malgré un poids de l'IS de plus en plus lourd dans ce pays – sous l'effet du déplacement de la base fiscale à l'intérieur de l'Europe comme l'analysent @tørsløv2022 ou encore d'un effet particulier de la fiscalité immobilière (@sec-immobilier).

```{r}
#| label: fig-rp
#| fig-asp: 0.85
#| fig-cap: Rendement du capital productif (avant et après IS)

date <- sourcoise::sourcoise_meta("R/vaq.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

data4tp <- source_data("R/vaq.r")$naaa |>
  filter(geo %in% P6) |>
  select(time, geo, champ, r, rb)

vroom::vroom_write(data4tp, "data/data4tp.csv")

tpbranches <- imap( 
  c("Marchandes-L" = "mdhi",
    "Marchandes-L68A" = "mdhim",
    "Marchandes-K-L68A" = "mdhimfi",
    "Marchandes" = "md"), ~{
      data <-  data4tp |> 
        filter(champ == .x) |> 
        mutate(tooltip = glue(
          "<b>{lbl(geo)}</b>
          {year(time)}
          Branches {.y}
          profits avant IS sur capital productif : {round(rb*100,1)}%
          profits après IS (estimation) sur capital productif : {round(r*100,1)}%"  ))
      data_long <- data |> 
        pivot_longer(c(r, rb), names_to = "concept", values_to = "value") |> 
        mutate(concept = factor(concept, c("rb", "r")))
      
      ggplot(data_long) +
        aes(x=time, y=value, col = geo) +
        geom_line(
          data=data,
          aes(y = rb, group = geo),
          color = "grey85", layout = "fixed", linewidth = 0.2) +
        ggbraid::geom_braid(
          data = data,
          aes(y=NULL,ymin=r, ymax=rb, group=geo), 
          fill="darkorchid", alpha=0.1, color = NA)+
        scale_linetype_manual(values = c(r="11", rb="solid"),
                              name=NULL, 
                              label = c(r="Après IS", rb= "Avant IS"))+
        scale_linewidth_manual(values = c(r=0.25, rb=0.5),
                              name=NULL, 
                              label = c(r="Après IS", rb= "Avant IS"))+
        geom_line(aes(y=value, group=concept, linewidth=concept, linetype=concept))+
        geom_point_interactive(
          data=data,
          aes(y = rb, tooltip = tooltip, data_id = time, fill = geo),
          size = 1, stroke = 0.5, shape = 21, color = "white",
          hover_nearest = TRUE, show.legend=FALSE) +
        ylab("% du capital") + xlab(NULL) +
        facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
        scale_ofce_date(
          labels = date1d ) +
        guides( fill = "none", color = "none",
                linetype = guide_legend(nrow = 1),
                alpha = guide_legend(nrow = 1)) + 
        scale_y_continuous(
          labels = scales::label_percent(1), 
          breaks = scales::pretty_breaks(5),
          limits = c(0, .2),
          oob = scales::oob_keep) +
        scale_color_pays(format = "eurostat") +
        ofce_caption(
          source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), actifs productifs (nama_10_nfa_st), téléchargés le {date}, code à github.com/xtimbeau/travail/R/vaq.r.",
          champ = "Branches {.y}.",
          note = "Les actifs productifs sont connus, selon les pays, jusqu'en 2024 ou 2023 ou 2022 (voir tableau A1). L'impôt sur les sociétés (D51, IS) des sociétés financières (S12) est affecté à la branche K et celui des sociétés non financières (S11) aux branches marchandes hors services financiers et immobilier des ménages (K+L68A). Le trait pointillé est le rendement après IS et le trait plein avant IS. Les traits colorés correspondent à chaque pays, les traits fins gris rappellent les autres pays.") +
        theme(legend.box.spacing = unit(1, "pt"))
      }) 

girafy(tpbranches[[1]], 1.5)
```

```{r, results="asis"}
margin_download(data4tp)
```

On détaille en les discutant dans la suite de ce document les effets des corrections appliquées, ainsi que la différence entre les mesures dérivées des comptes de branche ou des comptes d'agents (ou de secteurs institutionnels). Ces éléments sont un peu fastidieux, mais ils s'avèrent assez importants et pas toujours très intuitifs.

On explore également les conséquences en matière de taux de profit (part des profits nets dans la valeur ajoutée) ou rendement du capital (profits nets divisés par les actifs).

### Salaires réels et inflation

L'évolution des salaries réels est un complément à celle du partage de la valeur ajoutée. Pour passer de l'un à l'autre, il faut non seulement prendre en compte les évolutions de la valeur ajoutée, mais aussi les effets de l'évolution du ratio prix à la consommation sur prix de valeur ajoutée.

On déflate la masse salariale (comptabilité nationale, comptes trimestriels) par les prix à la consommation. On utilise les masses salariales ($D1$, dans [`namq_10_a10`](https://ec.europa.eu/eurostat/databrowser/view/NAMQ_10_A10/default/table?lang=en)) par branches pour comparer branches (principalement) marchandes et (principalement) non marchandes divisées par l'emploi salarié ([`namq_10_a10_e`](https://ec.europa.eu/eurostat/databrowser/view/NAMQ_10_A10_E__custom_7475124/default/table?lang=en)). Les prix sont les déflateurs de la consommation ($P31\_S14$ dans [`namq_10_fcs`](https://ec.europa.eu/eurostat/databrowser/product/page/NAMQ_10_FCS)) chaînés (voir le code pour les détails).

On distingue 4 agrégations : l'ensemble des branches (ou l'ensemble de l'économie), les branches non marchandes, les branches marchandes et les branches marchandes hors immobilier.

```{r, results="asis"}
#| label: fig-salaires
#| fig-cap: Salaires réels en Europe
#| fig-asp: 0.85

library(lubridate)

salaires <- source_data('R/salaires.r') |> 
  filter(geo %in% P6) 
meta <- sourcoise::sourcoise_meta("R/salaires.r")
date <- meta$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")
data <- salaires |> 
  filter(geo %in% P6) |> 
  filter(time >= "1995-01-01") |> 
  select(geo, time, w, w_md, w_nmd, w_hi, wb, wb_md, wb_nmd, wb_hi) |> 
  mutate(
    tooltip = glue(
    "<b>{lbl(geo)}</b>
    {date_trim(time)}</b>
    Salaire réel, toute l'économie {round(w,1)} k€/an
    Salaire réel, branches marchandes {round(w_md,1)} k€/an
    Salaire réel, branches marchandes hors imm. {round(w_hi,1)} k€/an
    Salaire réel, branches non marchandes {round(w_nmd,1)} k€/an"),
    tooltipb = glue(
    "<b>{lbl(geo)}</b>
    {date_trim(time)}</b>
    Salaire hors cot. soc. employeur réel, toute l'économie {round(wb,1)} k€/an
    Salaire hors cot. soc. employeur réel, branches marchandes {round(wb_md,1)} k€/an
    Salaire hors cot. soc. employeur réel, branches marchandes hors imm. {round(wb_hi,1)} k€/an
    Salaire hors cot. soc. employeur réel, branches non marchandes {round(wb_nmd,1)} k€/an")) |> 
  pivot_longer(starts_with("w")) |> 
  mutate(geo = factor(geo, P6))

lbl_b <- c(w = "Ttes branches", w_md = "Marchand", 
                     w_nmd = "Non marchand", w_hi = "Marchand hors imm.")
lbl_bb <- c(wb = "Ttes branches", wb_md = "Marchand", 
                     wb_nmd = "Non marchand", wb_hi = "Marchand hors imm.")
sal <- ggplot(data |> filter(name %in% c("w", "w_md", "w_nmd", "w_hi"))) +
  aes(x=time, y=value, 
      alpha = name, linewidth = name, linetype = name,
      color = geo) +
  scale_alpha_manual(
    values = c(w=1, w_md = 1, w_nmd = 0.75, w_hi = 0.75),
    labels = lbl_b, name = NULL) +
  scale_linetype_manual(
    values = c(w="solid", w_md ="solid", w_nmd ="solid", w_hi = "11"),
    labels = lbl_b,
    name = NULL) +
  scale_linewidth_manual(
    values = c(w=.5, w_md = 0.1, w_nmd = 0.25, w_hi= 0.5),
    labels = lbl_b, name = NULL) +
  geom_point_interactive(
    data = ~.x |> 
      filter( name == "w") |>  
      group_by(geo) |>
      filter(quarter(time) == last(quarter(time))) |>
      ungroup(),
    aes(tooltip = tooltip, data_id = time),
    size = 0.2, stroke = 0, hover_nearest = TRUE) +
  geom_line_interactive(
    aes(tooltip  = lbl_b[name])) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(labels = date1d) +
  ylab("Salaire annuel réel en k€") + xlab(NULL) +
  scale_y_log10(breaks = c(10, 20, 30, 40, 50, 50, 60),
                limits = c(25, 71)) +
  scale_color_pays(format = "eurostat") +
  theme(
    legend.direction = "horizontal") +
  guides(color = "none", fill="none") +
  ofce_caption(
    wrap = 0,
    source = "Eurostat, comptes nationaux trimestriels de branche (namq_10_a10), téléchargé le {date}, code à github.com/xtimbeau/travail/R/salaires.r.",
    champ = "Toute l'économie, salaires y compris cotisations sociales à la charge de l'employeur.",
    note = "Le salaire est défini comme la masse salariale (D1) divisée par l'emploi salarié, sur les 4 derniers trimestres, déflaté par le déflateur de la consommation (P31_S14) chaîné.",
    ofce = FALSE)
salb <- ggplot(data |> filter(name %in% c("wb", "wb_md", "wb_nmd", "wb_hi"))) +
  aes(x=time, y=value, 
      alpha = name, linewidth = name, linetype = name,
      color = geo) +
  scale_alpha_manual(
    values = c(wb=1, wb_md = 1, wb_nmd = 0.75, wb_hi = 0.75),
    labels = lbl_bb, name = NULL) +
  scale_linetype_manual(
    values = c(wb="solid", wb_md ="solid", wb_nmd ="solid", wb_hi = "11"),
    labels = lbl_bb,
    name = NULL) +
  scale_linewidth_manual(
    values = c(wb=.5, wb_md = 0.1, wb_nmd = 0.25, wb_hi= 0.5),
    labels = lbl_bb, name = NULL) +
  geom_point_interactive(
    data = ~.x |> 
      filter( name == "wb") |>  
      group_by(geo) |>
      filter(quarter(time) == last(quarter(time))) |>
      ungroup(),
    aes(tooltip = tooltip, data_id = time),
    size = 0.2, stroke = 0, hover_nearest = TRUE) +
  geom_line_interactive(
    aes(tooltip  = lbl_bb[name])) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(labels = date1d) +
  ylab("Salaire annuel réel en k€") + xlab(NULL) +
  scale_y_log10(breaks = c(10, 20, 30, 40, 50, 50, 60),
                limits = c(25, 71)) +
  scale_color_pays(format = "eurostat") +
  theme(
    legend.direction = "horizontal") +
  guides(color = "none", fill="none") +
  ofce_caption(
    wrap = 0,
    source = "Eurostat, comptes nationaux trimestriels de branche (namq_10_a10), téléchargé le {date}, code à github.com/xtimbeau/travail/R/salaires.r.",
    champ = "Toute l'économie, salaires hors cotisations sociales à la charge de l'employeur.",
    note = "Le salaire est défini comme la masse salariale (D11) divisée par l'emploi salarié, sur les 4 derniers trimestres, déflaté par le déflateur de la consommation (P31_S14) chaîné.",
    ofce = FALSE)

tabsetize(list("avec cot.soc. employeur" = sal,
               "sans cot.soc. employeur" = salb))

```

```{r, results="asis"}
margin_download(data |> select(-tooltip, -tooltipb))
```

En Italie et en Espagne, la masse salariale dans les branches non marchandes est supérieures à celle des branches non marchandes. Aux Pays-Bas et en Allemagne il n'y a pas de différence notable. En France, elle est significativement plus basse. Notons que les branches non marchandes ne sont pas nécessairement de l'emploi public et ce dans des proportions variables suivant les pays. Dans tous les pays, la masse salariale des branches immobilier et (surtout) services financiers est plus élevée que la masse salariale dans les autres branches marchandes.

## Comptes de branches : que changent les concepts et le champ ?

### Salariés et non salariés

On utilise les données de comptabilité nationale, en trimestriel, par branche ([`nasq_10_nf_tr`](https://ec.europa.eu/eurostat/databrowser/view/nasq_10_nf_tr/default/table?lang=en)), ré-agrégées au niveau de l'ensemble de l'économie. Le passage par les comptes de branches permet de distinguer branches marchandes et non marchandes ou d'autres regroupements, comme l'exclusion des services immobiliers. Ce passage permet également de conduire la correction salariés non salariés au niveau des branches. D'après l'INSEE, (voir le blog "[Combien pèse l'industrie en France et en Allemagne](https://blog.insee.fr/combien-pese-l-industrie-en-france-et-en-allemagne/)"), tous les pays ne produisent pas une comptabilité de branche mais pour certains (notamment l'Allemagne) une comptabilité sectorielle. La différence tient aux entreprises qui produisent plusieurs produits (un constructeur automobile propose des services financiers pour l'achat des véhicules) et dont l'activité est imputé à différentes branches (industrie et services financiers) dans la comptabilité de branche alors que dans une comptabilité de secteur l’activité est versée dans le principal secteur (ou le secteur d'immatriculation de l'entreprise chapeau). Cette différence empêche normalement les comparaisons des comptes de branches entre pays, y compris à l'intérieur de l'Union Européenne. Cependant, pour comparer la part des salaries dans la valeur ajoutée sur des agrégats larges (branches marchandes par exemple), cette dérogation à la norme comptable n'est que modérément problématique : de toute façon, l'automobile et les services financiers sont agrégés et c'est la correction pour la masse salariale des non salariés qui peut être modifiée. Mais si la même délimitation est employée pour les salariés et les non salariés que pour l'activité, l'erreur est probablement minime.

La part des salaires est corrigée de la part des non salariés (données annuelles [`nama_10_a64_e`](https://ec.europa.eu/eurostat/databrowser/view/nama_10_a64_e/default/table?lang=en), extrapolées en maintenant le ratio salariés/non salariés à sa dernière valeur observée) en considérant que le salaire des non salariés est identique dans chaque branche à celui des salariés – cette hypothèse, que nous appelons *correction par les effectifs*, sous estime probablement le salaire de certains des non salariés (notamment les professions libérales ou les artisans) mais elle est difficile à lever. Le développement des platerformes et dans certains pays de statuts (sociaux, fiscaux) particuliers (les micro-entrepreneurs – ou auto-entrepreneurs en France) a introduit une nouvelle "classe" de non salariés possiblement moins rémunérés et avec des durées du travail plus basses que le reste des indépendants. L'annexe D compile quelques éléments quantitatifs.

En revanche, dans la correction par les effectifs, on prend bien en compte que les non salariés de la branche agricole n'ont pas le même revenu que ceux de la branche "information et communication". La décomposition employée est à 9 branches et on peut conduire la même correction à un niveau de désagrégation plus fin. Une alternative est employée en utilsant les données de revenu mixte. A défaut d'être totalement convaincante, du fait d'un manque de données diffusées, elle montre la complexité et l'importance de la correction pour le revenu des indépendants. Une solution aurait pu être de ne considérer que les entreprises (voir @sec-snff) mais là aussi les différentes pratiques de comptabilité ne garantissent pas un traitement homogène d'un pays à l'autre.

La masse salariale est rapportée soit à la valeur ajoutée brute ($B1G$), soit à la valeur ajoutée nette ($B1N=B1G-P51C$). Comme la consommation de capital fixe ($P51C$) n'est pas connue en trimestriel, elle est dérivée des comptes annuels en 21 branches (niveau 1 de la NACE rev2 [`nama_10_a64`](#0)), agrégée en 9 branches, puis extrapolée pour les années non connues (ici 2024 et 2025) en conservant un ratio constant dans la valeur ajouté brute. Le détail se trouve dans le code.

Les trois graphiques suivants illustrent les conséquences sur la mesure de la part des salaires suivant les différents concepts. Le @fig-psalcnc compare avec et sans correction pour les non salariés. Deux rubans sont affichés, l'un pour les branches marchandes hors services immobiliers et financiers et l'autre pour toutes les branches.

L'avantage des comptes de branches est une définition homogène pour chacun des pays. La branche immobilier est exclue parce qu'il est impossible de distinguer les entreprises des ménages propriétaires (les loyers imputés sont une valeur ajoutée des ménages).

Les données trimestrielles sont annualisées pour la lisibilité et pour simplifier le mélange de données annuelles et trimestrielles. Le point 2025 (la dernière année) est donc un acquis sur les trimestres observés de l'année (ici 2 trimestres sur 4) susceptible de changer au fur et à mesure du temps. Il est possible en modifiant le code de produire un graphique trimestriel ou trimestriel lissé, à votre convenance.

```{r}
#| label: fig-psalcnc
#| fig-asp: 0.85
#| fig-cap: Correction pour la non salarisation, comptes de branches

champs  <- c(md = "marchand", 
             mdhifi = "marchand hors immobilier et services financiers",
             mdhfi= "marchand hors services financiers", 
             mdhi= "marchand hors imm.", 
             mdhim = "Marchand hors imm. mén.",
             tb = "Toutes branches (marchandes et non marchandes)")
naq <- source_data("R/vaq.r")$naa |> 
  filter(geo %in% P6) |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)} 
    {champs[champ]}
    Rémunérations (y.c. les non salariés) dans la VAN : {round(psal*100,1)}%
    Rémunérations (sans les non salariés) dans la VAN : {round(100*psalnc,1)}%")) |>
  mutate(geo = factor(geo, P6))

date <- sourcoise::sourcoise_meta("R/vaq.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

annot <-  tribble(
  ~time, ~psal, ~label, ~geo, ~champ,
  "1996-01-01", .89, "Branches marchandes hors immobilier et finance", "DE", "mdhifi",
  "1996-01-01", .61, "Branches marchandes et non marchandes", "DE", "tb") |> 
  mutate(time = as.Date(time),
         geo = factor(geo, P6))

labels_champ = c(tb = "Ttes branches", md="Marchand", 
                 mdhifi = "Marchand hors imm.&fin.",
                 mdhi = "Marchand hors imm.",
                 mdhim = "Marchand hors imm. mén.")

data <- naq |> 
  filter(champ %in% c("tb", "mdhi")) |> 
  select(time, geo, champ, psal, psalnc) |> 
  pivot_longer(c(psal, psalnc), names_to = "concept") |> 
  mutate(
    tooltip2 = ifelse(concept=="psal", 
                      "Part des salaires dans la VAN, non corrigée de la non salarisation",
                      "Part des salaires dans la VAN, corrigée de la non salarisation"))

psal <- ggplot(data) +
  aes(x=time, col = geo) +
  scale_alpha_manual(
    values = c(tb=.75, md=.75, mdhi = 1),
    labels = labels_champ,
    name = NULL) +
  scale_linetype_manual(
    values = c(tb="11", md="solid", mdhi ="solid"),
    labels = labels_champ,
    name = NULL) +
  scale_linewidth_manual(
    values = c(psal=.5, psalnc=0.2),
    labels = c(psal="Corrigé de la non salarisation", psalnc="Non corrigé"),
    name = NULL) +
  geom_ribbon(
    data = naq |> filter(champ %in%c("mdhi", "tb")),
    aes(ymin = psalnc, ymax = psal, fill = geo, group = champ), 
    color = NA, alpha=0.1, show.legend = FALSE) +
  geom_line_interactive( 
    aes(y=value, linetype = champ, linewidth = concept, alpha = champ,
        tooltip = tooltip2)) +
  geom_point_interactive(
    data = naq |> filter(champ == "mdhi"),
    aes(y=psal, tooltip = tooltip, data_id = time, fill = geo),
    size = 1, stroke = 0.5, shape = 21, color = "white",
    hover_nearest = TRUE, show.legend=FALSE) +
  #  geom_marquee(
  #    data = annot, hjust = 0, 
  #    aes(label = label),  size = 6, size.unit = "pt", show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d ) +
  guides( fill = "none", color = "none",
          linewidth = guide_legend(ncol = 1),
          alpha = guide_legend(ncol = 1), 
          linetype = guide_legend(ncol = 1)) + 
  scale_y_continuous(labels = scales::label_percent(1), 
                     breaks = scales::pretty_breaks(3)) +
  scale_color_pays(format = "eurostat") +
  theme(
    legend.position = "bottom",
    legend.direction = "horizontal",
    legend.justification = c(0.5, 0) ) +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}, code à github.com/xtimbeau/travail/R/vaq.r.",
 champ = "Branches marchandes et non marchandes (en léger et pointillé) et branches marchandes hors services immobiliers et financiers (L et K dans la NACE r2) (en plein).")

girafy(psal, 1.5)
```

La correction de la non salarisation, en imputant une masse salariale pour les entrepreneurs individuels à partir de la rémunération moyenne des salariés, augmente la part des salaires. La correction n'est pas constante dans le temps (c'est particulièrement fort pour la France) ni dans l'espace (la correction est très forte en Italie). La correction est plus importante lorsqu'on se limite aux branches marchandes hors services immobiliers et services financiers, sauf aux Pays-Bas.

Cette convention d'imputation d'un salaire aux non salariés est assez habituelle. Elle pose cependant un problème de cohérence avec la notion de revenu mixte mesuré dans la comptabilité nationale. Le revenu mixte est le revenu des entrepreneurs individuels, autoentrepreneurs et autres catégories d'indépendants. Il n'intègre pas l'activité des ménages en tant qu'employeurs (employés de maison) ou en tant que bailleur (loyers perçus ou imputés) qui sont comptabilisés dans l'excédent brut d'exploitation des ménages (S14). Le @tbl-mixte résume pour les 6 principaux pays analysés l'écart entre masse salariale imputée (en 2024) et revenu mixte.

```{r}
#| label: tbl-mixte
#| tbl-cap: "Revenu mixte et masse salariale imputée aux non salariés"
##| html-table-processing: none

pays <- source_data("R/nace.r")$pays1
mixte <- source_data("R/mixte.r")$a

nsal <- source_data("R/vaq.r")$naa |> 
  transmute(geo, time, champ, msa, msanc) |> 
  filter(champ == "tb", geo %in% pays) |> 
  left_join(mixte, by = c("geo", "time")) |> 
  mutate(
    geo = factor(geo, pays) ) |> 
  arrange(geo) |> 
  transmute(
    nsal = msa-msanc,
    b3g,
    rb3g = nsal/b3g-1, 
    geo_label = countrycode(geo, "eurostat", "country.name.fr"),
    geo = countrycode(geo, "eurostat", "iso3c"),
    year = year(time)) |> 
  pivot_wider(names_from = year, values_from = c(nsal, b3g, rb3g)) |> 
  select(geo, geo_label, nsal_2024, b3g_2024, starts_with("rb3g")) |> 
  rename_with(.cols  = starts_with("rb3g_"), .fn = ~str_remove(.x, "rb3g_")) |> 
  rename(nsal = nsal_2024,
         b3g = b3g_2024) |> 
  mutate(r = nsal/b3g)

nsal |> 
  gt() |> 
  fmt_flag(geo) |> 
  cols_nanoplot(
    columns = matches("[0-9]{4}"),
    plot_type = "bar",
    reference_line = 0,
    autoscale = TRUE,
    options = nanoplot_options(
      data_bar_stroke_color = alpha("red", 0.5),
      data_bar_fill_color = alpha("red", 0.5),
      data_bar_negative_stroke_color = alpha("green",0.5),
      data_bar_negative_fill_color = alpha("green", 0.5),
      data_bar_stroke_width = 0)) |> 
  cols_label(geo = "", geo_label ="",
             nsal = "(a) Salaires des non sal.",
             b3g = "(b) Revenu mixte", 
             r = "(a)/(b)",
             nanoplots = "de 1995 à 2025") |> 
  fmt_number(c(nsal, b3g), decimals = 0, scale_by = 1/1000, dec_mark = ",", sep_mark = " ", pattern = "{x} Mds€") |> 
  fmt_percent(c(r), decimals = 0, dec_mark = ",", sep_mark = " ") |> 
  cols_width(c(nsal, b3g, r) ~ px(100)) |> 
  cols_align_decimal(c(nsal, b3g, r), dec_mark = ",") |> 
  cols_align("center", nanoplots) |> 
  tab_source_note(
    md("*Champ* : Branches marchandes et non marchandes, année 2024 pour (a) et (b).") ) |> 
  tab_source_note(
    md("*Source* : Eurostat, comptes annuels de branche (nama_10_a64), et de transactions non financières (nasa_10_nf_tr).") ) |> 
  cols_hide_pdf(c("nanoplots", "geo")) |> 
  my_tab_options()
  
```

En France et en Belgique, la convention employée surestime probablement la masse salariale que l'on peut imputer aux non salariés, puisqu'elle apparaît supérieure au revenu mixte. En revanche, en Allemagne ou en Espagne, c'est potentiellement l'inverse. Le cas Français est intéressant, parce que le ratio masse salariale imputée sur revenu mixte devient plus grand que 1 en 2013 et et augmente quelques années avant. Le régime d'autoentrepreneur introduit en 2008 peut expliquer cette dynamique en augmentant le nombre de non salariés ayant de faibles revenus et éventuellement étant salariés par ailleurs (voir l'annexe D pour plus de détails).

On peut construire à partir du revenu mixte une correction alternative de la non salarisation en utilisant le revenu mixte – en retenant 88% du revenu mixte[^4], le reste pour approcher la CCF – et non le nombre de non salariés (correction par les effectifs) comme base de la correction.

[^4]: Le chiffre de 88% est établi à partir des comptes nationaux français qui permettent de calculer le ratio CCF sur revenu mixte pour les entrepreneurs individuels (secteur institutionnel S14AA). Pour la France nous utilisons le ratio calculé chaque année (qui varie entre 9,4% et 13,8% entre 1995 et 2024). Ce chiffre est plus faible que celui pour l'ensemble de l'économie marchande (de l'ordre de 20%, voir l'annexe B), ce qui peut s'expliquer par le fait que les structures fortement capitalistiques (et avec une forte CCF) sont moins suceptibles d'être des indépedants, parce qu'il est nécessaire de les financer par une structure de capital à responsabilité limitée et faisant intervenir des actionnaires qui ne sont pas le seul dirigeant. Enfin, nous supposons que dans le cas des indépendants la part des profits est nulle et que la rémunération de l'indépendant est équivalente à un revenu d'activité, ce qui est conforme au traitement fiscal en général. Lorsque l'entrepreneur souhaite bénéficier d'une fiscalité différente sur les revenus d'activité et les revenus du capital, il est contraint de passer d'un régime d'indépendant à une structure juridique moins souple.

```{r}
#| label: fig-psalmixte
#| fig-asp: 0.85
#| fig-cap: Correction pour la non salarisation, effectifs ou revenu mixte, comptes de branches

psal_fr <- source_data("R/france-melodi.R")$aggr |> 
  transmute(time, geo = "FR", champ, psal, psalm)

naq2 <- source_data("R/vaq.r")$naa |> 
  filter(geo %in% P6) |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)} 
    Part des salaires dans la VA nette, Branches marchandes
    Correction par les effectifs : {round(psal*100,1)}%
    Correction par le revenu mixte : {round(100*psalm,1)}%")) |>
  filter(champ %in% c("mdhi")) |> 
  select(time, geo, champ, psal, psalm, tooltip) |> 
  left_join(psal_fr, by = c("champ", "geo", "time"), suffix = c("",".fr") ) |> 
  mutate(psalm = ifelse(is.na(psalm.fr), psalm, psalm.fr)) |>
  select(-psalm.fr, -psal.fr) |> 
  mutate(geo = factor(geo, P6))

date <- sourcoise::sourcoise_meta("vaq.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

labels = c(psal = "Correction par les effectifs", psalm = "Correction par le revenu mixte")

data <- naq2 |>  
  pivot_longer(c(psal, psalm), names_to = "concept") |> 
  mutate(
    tooltip2 = ifelse(concept=="psal", 
                      "Correction par les effectifs (et salaire égal au salaire moyen)",
                      "Correction par le revenu mixte (80%)")) |> 
  mutate(geo = factor(geo, P6))

psal <- ggplot(data) +
  aes(x=time, col = geo) +
  ggbraid::geom_braid(
    data = naq2 |> mutate(s = psal>psalm),
    aes(ymin = psal, ymax = psalm, group = geo, fill = s), 
    color = NA, alpha=0.1, show.legend = FALSE) +
  scale_fill_manual(values = c("green", "red")) +
  ggnewscale::new_scale_fill() +
  scale_alpha_manual(
    values = c(psal=1, psalm = .75),
    labels = labels,
    name = NULL) +
  scale_linewidth_manual(
    values = c(psal=.5, psalm = 0.25),
    labels = labels,
    name = NULL) +
  geom_line_interactive( 
    aes(y=value, linewidth = concept, alpha = champ,
        tooltip = tooltip2)) +
  geom_point_interactive(
    data = naq2,
    shape = 21, color="white", stroke = 0.5, size =1, 
    aes(y=psal, tooltip = tooltip, data_id = time, fill = geo),
    hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d ) +
  guides( fill = "none", color = "none" ) + 
  scale_y_continuous(labels = scales::label_percent(1), 
                     breaks = scales::pretty_breaks(3)) +
  scale_color_pays(format = "eurostat") +
  theme(
    legend.position = "bottom",
    legend.direction = "horizontal",
    legend.justification = c(0.5, 0),
    legend.text = element_marquee(margin= margin(l=1))) +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}, INSEE activités des branches, CN2020, code à github.com/xtimbeau/travail/R/vaq.r et france-medoli.fr",
    champ = "Branches marchandes hors services immobiliers (-L).",
    note = "La correction par le revenu mixte n'est pas exacte pour le champ considéré, sauf pour la France pour laquelle le revenu mixte est disponible par branches (api melodi).")

girafy(psal, 1.5)
```

La correction est assez importante pour la France et la Belgique, ce qui est conforme aux valeurs affichées dans le @tbl-mixte. La hausse de la part des salaires apparaît moins importante que pour la correction par les effectifs. Au lieu d'une hausse de 8,3 points de pourcentage, elle n'est que de de 4,4 points. La comparaison avec les autres pays est donc un peu moins brutale que pour la correction par les effectifs, l'Allemagne ayant en 2023 une part des salaires dans la valeur ajoutée proche de celle de la France en suivant la correction par le revenu mixte, qui réhausse la part des salaires (voir aussi le @tbl-mixte) – à la réserve près que la correction est moins précise pour l'Allemagne puisque nous n'avons pas pu accéder aux données de revenu mixte par branches, contrairement à la France.

### Valeur ajoutée nette ou brute

```{r}
#| label: fig-psalnetbrut
#| fig-asp: 0.85
#| fig-cap: VA Nette ou brute, comptes de branches

champs  <- c("md" = "marchand",
            "mdhifi" = "marchand hors services immobiliers et financiers",
            "mdhi" = "marchand hors services immobiliers",
            "mdhfi"= "marchand hors services financiers", 
            "tb" = "Toutes branches (marchandes et non marchandes)")
naq <- source_data("R/vaq.r")$naa |> 
  filter(geo %in% P6) |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)} 
    {champs[champ]}
    Rémunérations (y.c. les non salariés) dans la VAN : {round(psal*100,1)}%
    Rémunérations (sans les non salariés) dans la VAB : {round(100*psalb,1)}%")) |>
  mutate(geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE")))

date <- sourcoise::sourcoise_meta("vaq.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

annot <-  tribble(
    ~time, ~psal, ~label, ~geo, ~champ,
    "1996-01-01", .89, "Branches marchandes hors immobilier et finance", "DE", "mdhifi",
    "1996-01-01", .61, "Branches marchandes et non marchandes", "DE", "tb") |> 
  mutate(time = as.Date(time),
         geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE")))

data <- naq |>
  select(geo, time, champ, psal, psalb) |> 
  filter(champ %in% c("tb", "mdhi")) |> 
  pivot_longer(c(psal, psalb), names_to = "concept") |> 
  mutate(
    tooltip2 = glue("{ifelse(concept=='psal', 'VA nette', 'VA brute')}")
  )

psal <- ggplot() +
  aes(x=time,  col = geo) +
  scale_alpha_manual(
    values = c(psalb=.25, psal = 1),
    labels = c(psal="VA nette", psalb="VA brute"),
    name = NULL) +
  scale_linetype_manual(
    values = c(tb="11", mdhi ="solid"),
    labels = labels_champ,
    name = NULL) +
  scale_linewidth_manual(
    values = c(psal=.5, psalb=.25),
    labels = c(psal="VA nette", psalb="VA brute"),
    name = NULL) +
  geom_ribbon(
     data = naq |> filter(champ %in% c("tb", "mdhi")),
     aes(ymin = psalb, ymax = psal, fill = geo, group = champ), 
     color = NA, alpha=0.1, show.legend = FALSE) +
  geom_line_interactive( 
    data = data,
    aes(y=value, linetype = champ, linewidth = concept, alpha = concept,
        group = interaction(geo, champ, concept),
        tooltip = tooltip2,
        data_id = time)) +
   geom_point_interactive(
     data = naq |> filter(champ == "mdhi"),
     aes(tooltip = tooltip, data_id = time, fill = geo, y=psal),
     size = 1, stroke = 0.5, shape = 21, color = "white",
     hover_nearest = TRUE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d ) +
  scale_y_continuous(labels = scales::label_percent(1),
                     breaks = scales::pretty_breaks(3)) +
  scale_color_pays(format = "eurostat") +
  guides(fill = "none", color = "none") +
  theme(
    legend.position = "bottom",
    legend.justification = c(.5, 0) ) +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}, github.com/xtimbeau/travail/R/vaq.r.",
    champ = "Branches marchandes et non marchandes (en léger et pointillé) et branches marchandes hors services immobiliers des ménages (-L68A) (en plein)")

girafy(psal, 1.5)
```

La notion de part des salaires dans la valeur ajoutée nette consiste à réduire le démominateur (la valeur ajoutée) de la consommation de capital fixe. Cela augmente donc le ratio. Cependant, cette correction n'est pas constante dans le temps (comme en France, en Espagne ou en Belgique). Comme on peut le voir sur le @appfig-psalcompote, la variance entre les pays est plus basse pour la notion brute (non corrigé de la CCF) que nette. Pour les branches marchandes hors services immobiliers et services immobiliers, le classement entre pays est marginalement modifié, la Belgique ayant une part des salaires nette pus élevée que l'Allemagne, alors que sa part brute est plus faible qu'en Allemagne. Pour les autres pays, le classement est identique (La France a la part la plus haute et les Pays-Bas plus faible).

### Impact du changement de structure de l'économie

On peut décomposer le changement de la part des salaires dans la valeur ajoutée en un effet de structure en branche et un effet de changement de la part des salaires dans la valeur ajoutée dans chaque branche. Formellement la décomposition retenue s'écrit (où $w_{b,t}$ est la part de VAN de la branche $b$ dans la valeur ajoutée nette de l'ensemble des branches considérées et $s_{b,t}$ la part des salaires dans la branche $b$) :

$$
\begin{aligned}
s_t - \sum w_{b,1995} \times s_{b,1995} = \sum w_{b,1995} \times (s_{b,t}-s_{b,1995}) \\ + \sum (w_{b,t} - w_{b,1995}) \times s_{b,t}  
\end{aligned}
$$

L'année 1995 est l'année de référence et le premier terme (de droite) s'interprète comme la part des salaires qui prévaudrait s'il n'y avait pas eu de changement de structure. Le @fig-structbranche représente ce terme ainsi que la part agrégée des salaires ($s_{t}$). L'effet de la structure par branche de l'économie (ici marchande hors services immobiliers produits par les ménages) est assez marginale. Les variations de la part des salaires sont bien celle des parts des salaires dans chaque secteur.

Il existe quelques exceptions à cette règle générale. A structure de branche inchangée, avec comme année de référence 1995, la part des salaires serait plus basse de 3,5 points de VA pour les Pays-Bas en 2025. En Allemagne ou en Belgique, le changement de structure des branches explique un petit peu de l'évolution à la hausse.

En revanche, la part des salaires serait légèrement supérieure en Italie à structure inchangée. Le pic de valeur ajoutée en 2013 est lié entièrement à la structure par branche, ce qui laisse supposer une rupture de série dans les comptes de branche.

```{r}
#| label: fig-structbranche
#| fig-cap: Structure par branche et part des salaires dans la VA
#| fig-asp: 0.85

decomp <- source_data("R/decomp.r") |> 
  mutate(
    psal = s0+s_sec+s_psal,
    psal_si = s0+s_psal,
    tooltip = glue("
  <b>{lbl(geo)}</b>
  {year(time)}
  Part des sal. dans la VA : {round(psal * 100, 1)}%
  Part des sal. dans la VA, structure de branche de 1995 : {round(psal_si * 100, 1)}%
  (Valeur ajoutée nette, cor. non sal., marchand hors imm. mén.)"))

gd <- ggplot(decomp) +
  aes(x = time, color = geo) +
  ggbraid::geom_braid(
    data = decomp,
    aes(ymin = psal_si, ymax = psal, fill = s_sec>0, group=geo), 
    alpha = 0.2,
    color = NA,  show.legend=FALSE) +
  scale_fill_manual(values = c("palegreen1", "pink")) +
  ggnewscale::new_scale_fill() +
  geom_line(
    aes(y=psal),
    linewidth = 0.5)+
  geom_line(
    aes(y=psal_si),
    linewidth = 0.5, linetype = "11")+
  geom_point_interactive(
    aes(y=s0+s_sec+s_psal, tooltip = tooltip, data_id = time, fill=geo),
    color = "white", stroke = 0.5, shape = 21,
    hover_nearest = TRUE, size = 1)+
  scale_alpha_manual(values=c(0.3, 0.1)) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d ) +
  scale_y_continuous(labels = scales::label_percent(1),
                     breaks = scales::pretty_breaks(3)) +
  scale_color_pays(format = "eurostat", aesthetics = c("color", "fill")) +
  guides(fill = "none", color = "none", alpha = "none") +
  theme(
    legend.position = "bottom",
    legend.justification = c(.5, 0) ) +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}, github.com/xtimbeau/travail/R/vaq.r.",
 note = "Le trait pointillé indique la part des salaires dans la VA si la structure de branche était la même qu'en 1995.",
 champ = "Branches marchandes hors services immobiliers des ménages (L68A)")

girafy(gd,1.5)

```

### Profits nets dans les comptes de branche {#sec-profits}

En utilisant d'une part la valeur ajoutée des branches marchandes hors services immobiliers produits par les ménages et la valeur des actifs productifs issue de la base des stocks de capital productif ([nama_10_nfa_st](https://ec.europa.eu/eurostat/databrowser/view/NAMA_10_NFA_ST__custom_2046386/default/table?lang=en)) sur le même champ (i.e. en enlevant la sous branche L68A), on peut estimer un rendement du capital productif.

```{r, results="asis"}
#| label: fig-tprofitbranches
#| fig-cap: Rendements du capital, compte de branches
#| fig-asp: 0.85

tabsetize(tpbranches)
```

Le rendement calculé sur le @fig-tprofitbranches diffère de celui du @fig-tprofitsnff. La différence vient en partie de la difficulté à imputer l'impôt des sociétés aux seules entreprises des branches marchandes – des entités légales dans les branches non marchandes peuvent être soumises à l'impôt sur les sociétés et de la valorisation des actifs. Dans l'approche comptes d'agents (ou de secteurs institutionnels), on affecte la valeur nette résiduelle des entreprises au stock de capital. De plus, le stock de capital n'est pas dans l'approche du @fig-tprofitsnff limité au capital productif mais intègre également des actifs financiers qui n'ont pas de contrepartie physique parce qu'ils sont hors territoire français.

La France conserve une singularité marquée par la baisse continue du taux de profit au cours du temps. Le rendement apparent du capital est ainsi très bas, plus bas que dans tous les autres pays considérés où il est plutôt stable (l'Italie fait exception avec une forte volatilité). Cette singularité subsiste lorsqu'on utilise la correction de la non salarisation par le revenu mixte au lieu des comptes de branches (@fig-rpmixte). La position de la France est un peu moins singulière, mais le diagnostic subsiste. L'écart avec l'Allemagne est significativement réduit dans cette configuration, puisqu'en 2023 le rendement du capital productif ressort à 8,2% en France contre 9,3% en Allemagne. L'écart avec les Pays-Bas subsiste presque entièrement (19,2% de rendement aux Pays-Bas).

```{r}
#| label: fig-rpmixte
#| fig-asp: 0.85
#| fig-cap: Rendement du capital productif, correction de la non salarisation par les effectifs ou le revenu mixte

date <- sourcoise::sourcoise_meta("R/vaq.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

psal_fr <- source_data("R/france-melodi.r")$aggr |> 
  transmute(time, geo = "FR", champ, van, msa, msam) |> 
  left_join(source_data("R/vaq.r")$naaa |>
              filter(geo == "FR") |>
              select(time, champ, assets, ip), 
            by = c("champ", "time")) |> 
  mutate(tpbm = (van - msam - ip)/van,
         rbm = (van - msam - ip)/assets,
         geo == "FR") |> 
  select(time, champ, geo, rbm) |> 
  drop_na(rbm)

data4tp <- source_data("R/vaq.r")$naaa |>
  filter(geo %in% P6) |>
  select(time, geo, champ, r, rb, rbm) |> 
  left_join(psal_fr, by=c("geo", "time", "champ"), suffix = c("",".fr")) |>
  mutate(rbm = ifelse(is.na(rbm.fr), rbm, rbm.fr)) |> 
  select(-rbm.fr) |> 
  mutate(geo = factor(geo, P6))

data <-  data4tp |> 
  filter(champ == "mdhi") |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
          {year(time)}
          Profits sur capital productif, avant IS, Branches marchandes,
          Correction effectif : {round(rb*100,1)}%
          Correction revenu mixte : {round(rbm*100,1)}%"  ))

data_long <- data |> 
  pivot_longer(c(rb, rbm), names_to = "concept", values_to = "value") |> 
  mutate(concept = factor(concept, c("rb", "rbm")))

tpmixte <- ggplot(data_long) +
        aes(x=time, y=value, col = geo) +
        geom_line(
          data=data,
          aes(y = rb, group = geo),
          color = "grey85", layout = "fixed", linewidth = 0.2) +
        scale_linetype_manual(values = c(rbm="11", rb="solid"),
                              name=NULL, 
                              label = c(rb="Correction effectif", rbm= "Correction revenu mixte"))+
        scale_linewidth_manual(values = c(rbm=0.25, rb=0.5),
                              name=NULL, 
                              label = c(rb="Correction effectif", rbm= "Correction revenu mixte"))+
        geom_line(aes(y=value, group=concept, linewidth=concept, linetype=concept))+
        geom_point_interactive(
          data=data,
          aes(y = rb, tooltip = tooltip, data_id = time, fill = geo),
          size = 1, stroke = 0.5, shape = 21, color = "white",
          hover_nearest = TRUE, show.legend=FALSE) +
        ylab("% du capital") + xlab(NULL) +
        facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
        scale_ofce_date(
          labels = date1d ) +
        guides( fill = "none", color = "none",
                linetype = guide_legend(nrow = 1),
                alpha = guide_legend(nrow = 1)) + 
        scale_y_continuous(
          labels = scales::label_percent(1), 
          breaks = scales::pretty_breaks(5),
          limits = c(0, .2),
          oob = scales::oob_keep) +
        scale_color_pays(format = "eurostat") +
        ofce_caption(
          source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), actifs productifs (nama_10_nfa_st), téléchargés le {date}, code à github.com/xtimbeau/travail/R/vaq.r.",
          champ = "Branches marchandes.",
          note = "Le rendement du capital est calculé selon deux corrections de la non salarisation (par les effectifs, par le revenu mixte), La correction est appliquée au champ branches marchandes hors immobiliers alors que le revenu mixte est connu pour l'ensemble de l'économie.") +
        theme(legend.box.spacing = unit(1, "pt"))

girafy(tpmixte, 1.5)
```

@reis2022 conclut que le rendement du capital productif est plutôt constant au cours du temps, pour les 20 dernières années. L'analyse présentée ici le contredit pour la France et possiblement d'autres pays. Les données utilisées ne sont pas les mêmes, puisqu'il utilise principalement AMECO et que l'analyse conduite ici exploite plus de profondeur dans les données de comptabilité nationale.

## Comptes d'agents ou de secteurs institutionnels : Entreprise non financières et financières {#sec-snff}

### Part des salaires dans la valeur ajoutée, comptes d'agents

Les comptes d'agents (ou de secteurs institutionnels) permettent une analyse plus simple, parce qu'ils permettent de distinguer les seules entreprises non financières. Cela évite d'avoir à prendre en compte les non salariés, cela exclue les services immobiliers produits par les ménages. C'est donc une analyse sur un champ économique plus strict (au sens de la forme légale des entités considérées). La notion d'impôt sur les sociétés est aussi mieux définie et le stock de capital productif est mieux connu du fait de l'obligation légale de déclaration des comptes des entreprises.

Malheureusement, comme identifié par l'INSEE, la pratique des instituts nationaux européens n'est pas conforme à celle de l'INSEE. Par exemple, en Allemagne, le secteur S11 inclut les quasi-sociétés et les entrepreneurs individuels. La normalisation des concepts est par ailleurs peu probable dans le futur, puisqu'elle est liée aux pratiques administratives.

Comme pour les graphiques précédents, les données trimestrielles sont annualisées (pour éliminer la variabilité trimestrielle qui nuit à la lisibilité et qui n'a pas beaucoup de sens). En trait pointillé, on représente la part de la valeur ajoutée dans les branches marchandes hors immobilier et corrigée de la non salarisation pour mesurer la différence des concepts.

```{r}
#| label: fig-s11psal
#| fig-cap: Part des salaires dans la VA, SNF, comptes d'agents
#| fig-asp: 0.85

snfq <- source_data("R/snf_ratio.r") |> 
  pluck("snfq") |>
  filter(sector == "S11", geo %in% P6) |> 
  mutate(year = floor_date(time, "year")) |> 
  select(-starts_with("s_adj_"), -time) |> 
  group_by(geo, year, sector) |> 
  summarize(across(everything(), ~sum(.x)/n()*4),
            .groups = "drop") |> 
  rename(time = year) |> 
  mutate(
    van = B1N,
    vab = B1G,
    msa = D1,
    psal = D1/B1N,
    psalb = D1/B1G,
    div = (D42)/B1N,
    divb = (D42)/B1G,
    isp = (D5+D2+D3)/B1N,
    tp = (B1N-D1-D5-D2-D3)/B1N ) |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)}
    Impôts net de subvention dans la VAN : {round(100*isp,1)}%
    Rémunérations dans la VAN : {round(psal*100,1)}%
    Rémunérations dans la VAB : {round(psalb*100,1)}%
    Profits nets (d'IS, taxes et subvention) dans la VAN : {round(tp*100,1)}%
    Dividendes nets dans la VAN : {round(div*100,1)}%")) |> 
  mutate(geo = factor(geo, P6)) |> 
  filter(time>= "1995-01-01")

date <- sourcoise::sourcoise_meta("R/snf_ratio.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")
naq_a <-  naq |> 
  filter(champ == "mdhifi") |> 
  select(geo, time, psal_branche  = psal, psalb_branche = psalb)
data <- snfq |> 
  select(geo, time, psal_snf = psal, psalb_snf = psalb) |> 
  left_join(naq_a, by = c("geo", "time")) |> 
  pivot_longer(starts_with("psal")) |> 
  separate(name, into = c("concept", "champ")) |> 
  filter(time>="1995-01-01", !(concept=="psalb"&champ=="branche")) |> 
  mutate(
    tooltip2 = glue("Valeur ajoutée {ifelse(concept=='psal', 'nette', 'brute')}; {ifelse(champ=='snf', 'SNF', 'branches marchandes hors imm.&fin.')}") )

psnf <- ggplot(data) +
  aes(x=time,  col = geo) +
  scale_alpha_manual(
    values = c(psal = 1, psalb=0.5),
    labels = c(psal = "VA nette", psalb="VA brute"),
    name = NULL)+
  scale_linetype_manual(
    values = c(snf = "solid", branche="11"),
    labels = c(branche = "Branches non marchandes hors imm.&fin.", snf = "SNF"),
    name  = NULL) +
  scale_linewidth_manual(
    values = c(psal = .5, psalb=0.2),
    labels = c(psal = "VA nette", psalb="VA brute"),
    name  = NULL)+
  geom_ribbon(
    data = snfq,
    aes(ymin = psalb, ymax =psal, fill = geo), alpha =0.1, color = NA) +
  geom_line_interactive(
    aes(y=value, linetype = champ, linewidth = concept, alpha = concept,
        group = interaction(champ, concept, geo),
      tooltip = tooltip2)) +
  geom_point_interactive(
     data = snfq,
     aes( y = psal, fill = geo,
        tooltip = tooltip, data_id = time),
        size = 1, stroke = 0.5, shape = 21, color = "white",
        hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
   labels = date1d ) +
  scale_y_continuous(labels = scales::label_percent(1)) +
  scale_color_pays(format = "eurostat") +
  theme(
    legend.position = "bottom",
    legend.justification = c(0.5, 1),
    legend.direction = "horizontal",
    legend.spacing.y = unit(4, "pt") ) +
  guides(color = "none", fill = "none",
         linetype = guide_legend(ncol = 1),
         linewidth = guide_legend(order=1, ncol = 1),
         alpha = guide_legend(order=1, ncol = 1)) +
  ofce_caption(
    source = "Eurostat, comptes nationaux trimestriels d'agents ou de secteurs institutionels (nasq_10_nf_tr), téléchargés le {date}, github.com/xtimbeau/travail/R/snf_ratio.r.",
    champ = "Sociétés non financières (les définitions varient suivant les pays)")

girafy(psnf, 1.5)
```

```{r}
#| label: fig-s1112psal
#| fig-cap: Part des salaires dans la VA, SNF+SF, comptes d'agents
#| fig-asp: 0.85 

snffq <- source_data("R/snf_ratio.r") |> 
  pluck("snfq") |> 
  filter(geo %in% P6) |> 
  mutate(year = floor_date(time, "year")) |> 
  select(-starts_with("s_adj_")) |> 
  group_by(geo, time, year) |> 
  summarize(across(-sector, ~sum(.x)),
            .groups = "drop") |> 
  group_by(geo, year) |> 
  select(-time) |> 
  summarize(across(everything(), ~sum(.x)/n()*4),
            .groups = "drop") |> 
  rename(time = year) |> 
  mutate(
    van = B1N,
    vab = B1G,
    msa = D1,
    psal = D1/B1N,
    psalb = D1/B1G,
    div = (D42)/B1N,
    divb = (D42)/B1G,
    isp = (D5+D2+D3)/B1N,
    tp = (B1N-D1-D5-D2-D3)/B1N ) |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)}
    Impôts net de subvention dans la VAN : {round(100*isp,1)}%
    Rémunérations dans la VAN : {round(psal*100,1)}%
    Rémunérations dans la VAB : {round(psalb*100,1)}%
    Profits nets (d'IS, taxes et subvention) dans la VAN : {round(tp*100,1)}%
    Dividendes nets dans la VAN : {round(div*100,1)}%")) |> 
  mutate(geo = factor(geo, P6)) |> 
  filter(time>= "1995-01-01")

date <- sourcoise::sourcoise_meta("snf_ratio.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")
naq_a <-  naq |> 
  filter(champ == "mdhi") |> 
  select(geo, time, psal_branche  = psal, psalb_branche = psalb)
data <- snfq |> 
  select(geo, time, psal_snf = psal, psalb_snf = psalb) |> 
  left_join(naq_a, by = c("geo", "time")) |> 
  pivot_longer(starts_with("psal")) |> 
  separate(name, into = c("concept", "champ")) |> 
  filter(time>="1995-01-01", !(concept=="psalb"&champ=="branche")) |> 
  mutate(
    tooltip2 = glue("Valeur ajoutée {ifelse(concept=='psal', 'nette', 'brute')}; {ifelse(champ=='snf', 'SNF', 'branches marchandes hors imm.')}") )

psnff <- ggplot(data) +
  aes(x=time,  col = geo) +
  scale_alpha_manual(
    values = c(psal = 1, psalb=0.5),
    labels = c(psal = "VA nette", psalb="VA brute"),
    name = NULL)+
  scale_linetype_manual(
    values = c(snf = "solid", branche="11"),
    labels = c(branche = "Branches non marchandes hors imm..", snf = "SNF+SF"),
    name  = NULL) +
  scale_linewidth_manual(
    values = c(psal = .5, psalb=0.2),
    labels = c(psal = "VA nette", psalb="VA brute"),
    name  = NULL)+
  geom_ribbon(
    data = snfq,
    aes(ymin = psalb, ymax =psal, fill = geo), alpha =0.1, color = NA) +
  geom_line_interactive(
    aes(y=value, linetype = champ, linewidth = concept, alpha = concept,
        group = interaction(champ, concept, geo),
      tooltip = tooltip2)) +
  geom_point_interactive(
     data = snfq,
     aes( y = psal, fill = geo,
        tooltip = tooltip, data_id = time),
        size = 1, stroke = 0.5, shape = 21, color = "white",
        hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
   labels = date1d ) +
  scale_y_continuous(labels = scales::label_percent(1)) +
  scale_color_pays(format = "eurostat") +
  theme(
    legend.position = "bottom",
    legend.justification = c(0.5, 1),
    legend.direction = "horizontal",
    legend.spacing.y = unit(4, "pt") ) +
  guides(color = "none", fill = "none",
         linetype = guide_legend(ncol = 1),
         linewidth = guide_legend(order=1,ncol = 1),
         alpha = guide_legend(order=1,ncol = 1)) +
  ofce_caption(
    source = "Eurostat, comptes nationaux trimestriels d'agents ou de secteurs institutionels (nasq_10_nf_tr), téléchargés le {date}, github.com/xtimbeau/travail/R/snf_ratio.r.",
    champ = "Sociétés non financières et financières (les définitions varient suivant les pays)")

girafy(psnff, 1.5)
```

### Profits nets et dividendes dans les comptes d'agents {#sec-profitagent}

Les comptes des sociétés non financières permettent d’examiner d'autres éléments du compte. On affiche ici le profit net sur la valeur ajoutée nette, et le taux de dividendes nets sur la valeur ajoutée nette.

Les profits nets sont définis comme la valeur ajoutée nette de la consommation de capital fixe moins la rémunération des salariés, moins les taxes nettes des subventions moins l'impôt sur les sociétés :

$$
\Pi = B1G - P51C - D1 - (D2-D3) - D5 = B2N-D5
$$

Les dividendes sont la ligne $D42$ nette de ce qui est payé et reçu par le secteur des sociétés non financières (SNF ou S11).

```{r}
#| label: fig-profits
#| fig-cap: Profits nets dans la VA, SNF, comptes d'agents
#| fig-asp: 0.85

data <- snfq |> 
  filter(time >= "1995-01-01") |> 
  select(time, geo, tp, div) |> 
  pivot_longer(c(tp, div)) |> 
  mutate(tooltip2 = glue("{ifelse(name=='tp', 'Profits nets sur VAN, SNF', 'Dividendes nets sur VAN, SNF' )}")) |> 
  mutate(name = factor(name, c("tp","div")))

pprofit <- ggplot(data) +
  aes(x=time, col = geo) +
  scale_linewidth_manual(
    values = c(tp = 0.5, div = 0.25), 
    labels = c(tp = "Profits nets", div = "Dividendes"), 
    name = NULL) +
  scale_alpha_manual(
    values = c(tp = 1, div = 0.75),
    labels = c(tp = "Profits nets", div = "Dividendes"), 
    name = NULL) +
  geom_line_interactive(
     aes( y=value, linewidth = name, alpha = name, tooltip = tooltip2),
     hover_nearest = TRUE) +
  geom_point_interactive(
    data = snfq,
    aes(fill = geo, y = tp,
        tooltip = tooltip, data_id = time),
        size = 1, stroke = 0.5, shape = 21, color = "white",
        hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
   labels = date1d ) +
  scale_y_continuous(labels = scales::label_percent(1)) +
  scale_color_pays(format = "eurostat") +
  theme(legend.direction = "horizontal") +
  guides(color = "none", fill = "none") +
  ofce_caption(
    source = "Eurostat, comptes nationaux trimestriels de secteur (nasq_10_nf_tr), téléchargés le {date}, github.com/xtimbeau/travail/R/snf_ratio.r.",
    champ = "Sociétés non financières (les définitions varient suivant les pays)")

girafy(pprofit, 1.5)
```

On peut rapporter ces notions aux éléments qui viennent du compte de capital. Le premier concept est le profit rapporté au stock de capital physique (tel que valorisé dans la comptabilité nationale, c'est-à-dire à la valeur de remplacement et au prix de marché). Malheureusement, à part la France, aucun pays dans notre échantillon ne diffuse ces données sur Eurostat.

On rapporte également à une notion financière, à savoir la valeur nette des actions au passif des comptes d'entreprises. Les conventions de valorisation des actions non cotées sont délicates et difficiles à suivre d'un pays à l'autre. On choisit ici d'augmenter ces actions de la valeur nette résiduelle des entreprises non financières ($BF90$). On a donc :

$$
\begin{aligned}
r_{productif} & = \frac{\Pi}{N1N+N2N} \\
r_{financier} & = \frac{\Pi}{F51+F52+BF90}
\end{aligned}
$$

On obtient le graphe suivant :

```{r}

assetsnfi <- source_data("R/snf_ratio.r") |> 
  pluck("assetsnfi") |> 
  filter(sector == "S11", geo %in% P6) |> 
  transmute(geo, time, phycap = N1N + N2N) |>
  mutate(geo = factor(geo, P6))

assetsfi <- source_data("R/snf_ratio.r") |> 
  pluck("assetsfi") |> 
  filter(sector == "S11", geo %in% P6) |> 
  select(geo, time, net_shares, net_shares_augmented) |>
  mutate(geo = factor(geo, P6))

snfq_a <- snfq |> 
  filter(time >= "1995-01-01") |> 
  left_join(assetsfi, by = c("geo", "time")) |> 
  left_join(assetsnfi, by = c("geo", "time")) |> 
  transmute(
    geo, time,
    rendphy = tp*B1N/phycap,
    rendshare = tp*B1N/net_shares,
    rendshareaug = tp*B1N/net_shares_augmented) |> 
  mutate(tooltip2 = glue(
  "<b>{lbl(geo)}</b>
  {year(time)}
  Rendement productif SNF : {round(100*rendphy,1)}% par an
  Rendement financier SNF : {round(100*rendshareaug,1)}% par an")) |> 
  pivot_longer(-c(geo, time, tooltip2)) |> 
  mutate(
    tooltip = glue("Profits sur {ifelse(name=='rendphy', 'actifs productifs', 'fonds propres augmentés de la valeur résiduelle')}") )

ptprofitsnf <- ggplot(snfq_a |> filter(name != "rendshare")) +
  aes(x=time, col = geo, linewidth = name, alpha = name) +
  scale_alpha_manual(
    values = c(rendphy = 0.75, rendshareaug = 1),
    labels = c(rendphy = "rendement productif", rendshareaug = "rendement financier"),
    name = NULL
  ) +
  scale_linewidth_manual(
    values = c(rendphy = 0.25, rendshareaug = .5),
    labels = c(rendphy = "rendement productif", rendshareaug = "rendement financier"),
    name = NULL
  ) +
  geom_line_interactive(
     aes(y = value, 
         tooltip = tooltip) ) +
  geom_point_interactive(
    data = ~.x |> filter(name == "rendshareaug"),
     aes(fill = geo, y = value,
        tooltip = tooltip2, data_id = time),
        size = 1, stroke = 0.5, shape = 21, color = "white",
        hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% du stock de capital") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
   labels = date1d ) +
  scale_y_continuous(labels = scales::label_percent(1), limits = c(0,0.3)) +
  scale_color_pays(format = "eurostat") +
  theme(legend.direction = "horizontal") +
  guides(fill = "none", color = "none") +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels de secteur (nasa_10_nf_tr), capital productif par branche (nama_10_nfa_bs) et comptes de patrimoine (naidsa_10_f_bs), téléchargés le {date}, code à github.com/xtimbeau/travail/R/snf_ratio.r.",
    champ = "Sociétés non financières (les définitions varient suivant les pays)")


assetsnfi <- source_data("R/snf_ratio.r") |> 
  pluck("assetsnfi") |>
  filter(geo %in% P6) |> 
  group_by(geo, time) |> 
  summarize(across(c(N1N,N2N,N11N), ~sum(.x)),
            .groups = "drop") |> 
  transmute(geo, time, phycap = N1N + N2N) |>
  filter(phycap>0) |> 
  mutate(geo = factor(geo, P6))

assetsfi <- source_data("R/snf_ratio.r") |> 
  pluck("assetsfi") |> 
  filter(geo %in% P6) |> 
  group_by(geo, time) |>  
  summarize(across(c(net_shares, net_shares_augmented), sum),
            .groups = "drop") |> 
  select(geo, time, net_shares, net_shares_augmented) |>
  mutate(geo = factor(geo, P6))

snfq_a <- snfq |> 
  filter(time >= "1995-01-01") |> 
  group_by(geo, time) |> 
  summarize(
    tp = sum(B1N*tp)/sum(B1N),
    B1N = sum(B1N)  ) |> 
  left_join(assetsfi, by = c("geo", "time")) |> 
  left_join(assetsnfi, by = c("geo", "time")) |> 
  transmute(
    geo, time,
    rendphy = tp*B1N/phycap,
    rendshare = tp*B1N/net_shares,
    rendshareaug = tp*B1N/net_shares_augmented) |> 
  mutate(tooltip2 = glue(
  "<b>{lbl(geo)}</b>
  {year(time)}
  Rendement productif SNF+SF : {round(100*rendphy,1)}% par an
  Rendement financier SNF+SF : {round(100*rendshareaug,1)}% par an")) |> 
  pivot_longer(-c(geo, time, tooltip2)) |> 
  mutate(
    tooltip = glue("Profits sur {ifelse(name=='rendphy', 'actifs productifs', 'fonds propres augmentés de la valeur résiduelle')}") )

ptprofitsnff <- ggplot(snfq_a |> filter(name != "rendshare")) +
  aes(x=time, col = geo, linewidth = name, alpha = name) +
  scale_alpha_manual(
    values = c(rendphy = 0.75, rendshareaug = 1),
    labels = c(rendphy = "rendement productif", rendshareaug = "rendement financier"),
    name = NULL
  ) +
  scale_linewidth_manual(
    values = c(rendphy = 0.25, rendshareaug = .5),
    labels = c(rendphy = "rendement productif", rendshareaug = "rendement financier"),
    name = NULL
  ) +
  geom_line_interactive(
     aes(y = value, 
         tooltip = tooltip) ) +
  geom_point_interactive(
    data = ~.x |> filter(name == "rendshareaug"),
     aes(fill = geo, y = value,
        tooltip = tooltip2, data_id = time),
        size = 1, stroke = 0.5, shape = 21, color = "white",
        hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% du stock de capital") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
   labels = date1d ) +
  scale_y_continuous(labels = scales::label_percent(1), limits = c(0,0.3)) +
  scale_color_pays(format = "eurostat") +
  theme(legend.direction = "horizontal") +
  guides(fill = "none", color = "none") +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels de secteur (nasa_10_nf_tr), capital productif par branche (nama_10_nfa_bs) et comptes de patrimoine (naidsa_10_f_bs), téléchargés le {date}, code à github.com/xtimbeau/travail/R/snf_ratio.r.",
    champ = "Sociétés non financières (les définitions varient suivant les pays)")
```

```{r, results="asis"}
#| label: fig-tprofitsnff
#| fig-cap: Rendements du capital, compte de secteur
#| fig-asp: 0.85

tabsetize(list("SNF" = ptprofitsnf, "SNF+SF" = ptprofitsnff))
```

## Au delà de l'Europe et pour l'ensemble de l'économie

L'accès aux données de l'OCDE est devenu particulièrement opaque, mais je m'en suis sorti. Il est possible d'utiliser des données de comptabilité nationale, au niveau de l'ensemble de l'économie (y compris donc les branches non marchandes et l'immobilier). La correction pour la non-salarisation est assurée par les données de l'*Economic Outlook* (avec une trimestrialisation ad hoc). Au lieu de la valeur ajoutée, on utilise le PIB, auquel on enlève la consommation de capital fixe (dans les données OCDE, il n'y a pas de données de CCF pour le Japon publiées). Le concept de part des salaires n'est donc pas tout à fait le même que dans les autres analyses.

On obtient le @fig-psaloecd, qui rejoint ceux présentés, bien que l'agrégation à l'ensemble de l'économie écrase les évolutions.

```{r}
#| label: fig-psaloecd
#| fig-cap: "Part des salaries dans le PIN, données SNA de l'OCDE"
#| fig-asp: 0.85

data <- ofce::source_data("R/oecd.r") |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {date_trim(time)}
    Salaires dans le Produit Intérieur Net de la CCF : {round(100*psalaire,1)}%")) |> 
  mutate(geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE", "US", "UK", "JP")),
         q = quarter(time))

date <- sourcoise::sourcoise_meta("R/oecd.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

psaloecd <- ggplot(data |> filter(year(time)>=1995)) +
  aes(x=time, y=psalaire, col = geo) +
  geom_line_interactive(
    aes(tooltip = "Part des salaires dans le PIN, corrigée de la non salarisation"),
    show.legend=FALSE) +
  geom_point_interactive(
    data = ~.x |> group_by(geo) |> filter(q == last(q)) |> ungroup(),
    aes(tooltip = tooltip, data_id = time, fill = geo),
    size = .2, stroke = 0.1, shape = 21, color = "white",
    hover_nearest = TRUE, show.legend=FALSE) +
  ylab("En % du PIN") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d
  ) +
  scale_y_continuous(labels = scales::label_percent(1)) +
  scale_color_pays(format = "eurostat") +
  ofce_caption(
    source = "OECD, comptes nationaux, téléchargés le {date},
 code à github.com/xtimbeau/travail/R/oecd.r.",
    champ = "Toutes branches, y compris services immobiliers")

girafy(psaloecd, 1.5)
```

En revanche, Eurostat a un programme de coopération (avec l'OCDE) pour intégrer les données dans le cadre d'Eurostat (sans que les méthodes ne soient plus homogènes pour autant).

On utilise ces données ([`naidsa_10_nf_tr`](https://ec.europa.eu/eurostat/databrowser/view/naidsa_10_nf_tr__custom_13241966/default/table?lang=en)) pour construire des indicateurs comparables en comparant des pays autres que ceux de la zone euro.

```{r, eval=TRUE}
#| label: fig-tprofithze
#| fig-cap: Part des salaires dans la valeur ajoutée, comptes de secteur, comparaisons internationales
#| fig-asp: 0.6

psali <- source_data("R/psali.r")
girafy(psali, 1.5)

```

## Le rendement de l'immobilier {#sec-immobilier}

Plusieurs explications peuvent être avancées à la dégradation du rendement du capital productif[^5] :

[^5]: On peut aussi mettre en cause la qualité des comptes nationaux et leur incapacité à apporter une information même bruitée sur la réalité des économies contemporaines. Cette explication est commode lorsqu'on a une théorie envers laquelles les "faits" comptables sont têtus. Nous partons du principe qu'on peut

-   une part des salaires dans la valeur ajoutée trop importante, ce que suggèrent les éléments présentés plus haut,

-   une fonction de production agrégée spécifique qui implique une part de l'immobilier plus importante compte tenu de la structure et de la technologie de l'économie française. Alternativement, si les services immobiliers sont imparfaitement substituables (ce qui est probable) aux autres facteurs de production, un prix relatif plus élévé de ces services immobiliers peut conduire à une part plus importante des consommations intermédiaires (en valeur).

-   une mauvaise évaluation de la valeur des actifs productifs conduisant à surestimer le stock de capital productif, par exemple en sous estimant la consommation de capital fixe. L'annexe B tend à contredire cette idée, la CCF étant plutôt plus élevée en France qu'ailleurs et le taux de dépréciation (CCF sur actif) étant assez stable dans le temps.

-   un mécanisme d'optimisation fiscale par des prix de transfert vers d'autres pays européens (ce qu'explorent @tørsløv2022), en particulier les Pays-Bas, qui affichent un rendement élevé et croissant du capital productif,

-   un autre mécanisme d'optimisation fiscale, par la séparation des activités productives et des locaux qui leur sont nécessaires. Les loyers sont alors un prix de transfert et permettraient de bénéficier de la fiscalité avantageuse de l'immobilier[^6].

[^6]: Une recherche sur internet aboutit rapidement à des documents de ce type : [Les fondamentaux de l'investissement immobilier professionnel](https://www.frenchfigures.com/blog/placement-immobilier-entreprise#:~:text=Optimisation%20de%20l%27Imp%C3%B4t%20sur%20les%20Soci%C3%A9t%C3%A9s&text=Les%20loyers%20vers%C3%A9s%20par%20votre%20entreprise%20%C3%A0%20la%20structure%20d%C3%A9tenant,patrimoine%20immobilier%20du%20risque%20entrepreneurial.). Le principe est que les plus values immobilières sont moins taxées que les flux de revenus à terme.

Nous explorons dans cette section cette piste. La difficulté est que l'activité résidentielle, et sa partie autoproduite, sont intégrées dans la branche "services immobiliers". A partir des données détaillées de consommation (base [`nama_10_cp18`](https://ec.europa.eu/eurostat/databrowser/view/nama_10_cp18__custom_18526061/default/table)), on peut approximativement[^7] reconstituer ces parts. Le @tbl-households fait apparaître que la valeur ajoutée de la branche "services immobiliers (L)" est particulièrement importante en France et que la partie hors service de logement des ménages est aussi particulièrement élevée.

[^7]: En ne prenant en compte que la consommation, on manque l'investissement des ménages en services immobiliers, à savoir les frais de transaction et d'agence lors des ventes.

```{r}
#| label: tbl-households
#| tbl-cap: Part des loyers et des loyers imputés dans la valeur ajoutée marchande

data <- source_data("R/households.r")
data |>
  filter(time==max(time), geo %in% P6) |> 
  select(geo, L, Ll, Lli) |> 
  mutate(
    LmLl = L -Ll, 
    lbl_geo = countrycode(geo, "eurostat", "country.name.fr"),
    geo = factor(geo, P6)) |> 
  relocate(geo, lbl_geo, L, LmLl, Ll, Lli) |>
  arrange(geo) |> 
  gt() |> 
  tab_spanner(label = "Part dans la VAB marchande en 2024 des",
              columns = c(L, LmLl, Ll, Lli)) |>
  cols_label(geo="", lbl_geo="", 
             L="services immobiliers",
             LmLl="services immobiliers hors ménages",
             Ll= "loyers des ménages", 
             Lli = "loyers imputés aux ménages" ) |> 
  fmt_percent(-geo, decimals=1, dec_mark = ",", sep_mark = " ") |> 
  cols_align_decimal(-geo, dec_mark = ",") |> 
  fmt_flag(geo) |> 
  cols_width(
    geo ~ px(30),
    lbl_geo ~ px(120) , 
    everything() ~ px(100)) |> 
  tab_options(table.font.size = 12) |> 
  # gt::tab_header(
  #   title = NULL, 
  #   subtitle = "Part dans la VAB marchande en 2024 des") |> 
  tab_source_note(md("*Source* : Eurostat Household final consumption expenditure by purpose (nama_10_cp18)")) |> 
  cols_hide_pdf("geo")
```

Le @fig-ciLfr, pour la France uniquement, caractérise l'évolution de la consommation en services immobiliers par le secteur productif hors services aux ménages. La hausse est continue depuis le début de la période d'observation (qui débute en 1978 sur le @fig-ciLfr), et s'achève en 2006. Cette hausse de la part des consommations intermédiaires ne peut donc pas expliquer à elle seule les évolutions du rendement apparent du capital productif.

```{r}
#| label: fig-ciLfr
#| fig-cap: Consommations intermédiaires en services immobiliers, France
#| fig-asp: 0.7

data <- source_data("R/france-melodi.r") |> 
  pluck("aggr") |>
  filter(champ%in%c("md", "mdhi")) |> 
  mutate(
    ciL = p2l/vab) |> 
  select(time, ciL, champ) |> 
  pivot_wider(names_from = champ, values_from = ciL) |> 
  mutate(
    tp = glue(
    "<b>{year(time)}</b> France
    Part des CI branche L dans la VAB marchande hors immobilier : {round(mdhi*100, 1)}%
    Part des CI branche L dans la VAB marchande : {round(md*100, 1)}%") ) |> 
  pivot_longer(c(md, mdhi), names_to = "champ")

gg <- ggplot(data) +
  aes(x=time, y=value) +
  geom_line(
    aes(linetype = champ, color = champ) ) +
  scale_color_manual(
    values = c(md="pink2", mdhi = "steelblue2"),
    aesthetics = c("fill", "color"),
    name = NULL, 
    labels = c(md = "branches marchandes", 
    mdhi = "Branches marchandes hors immobilier")) +
  scale_linetype_manual(
    values = c(md="11", mdhi = "solid"),
    name = NULL, 
    labels = c(md = "branches marchandes", 
    mdhi = "Branches marchandes hors immobilier")) +
  geom_point_interactive(
    data = ~.x |> filter(champ=="mdhi"),
    aes(tooltip=tp, data_id = time, fill = champ),
    hover_nearest = TRUE,
    shape = 21, stroke = 0.5, color = "white") +
  scale_y_continuous(labels = scales::label_percent(.1, decimal.mark = ",")) +
  labs(y="% de la VAB", x = NULL) +
  scale_ofce_date(
    labels = date1d) +
  ofce_caption(
    source="INSEE, comptes nationaux table des entrées sorties (CNA_SUT)"
  )+
  theme(
    legend.direction = "horizontal" )

girafy(gg)
```

Le @fig-rendfr confirme cette idée, mais illustre l'ordre de grandeur que les services immobiliers pourraient avoir sur le rendement du capital. Les deux courbes présentées sont d'une part le rendement avant IS du capital productif des branches marchandes non immobilières et d'autre part le même rendement, mais en modifiant la valeur ajoutée des branches marchandes non immobilières en appliquant le ratio consommation intermédiaire en services immobiliers de 1980 (il était alors de 3,3%). Cela représente plus d'un point de rendement.

```{r}
#| label: fig-rendfr
#| fig-cap: Rendement du capital productif, sensibilité aux CI en services immobiliers, France
#| fig-asp: 0.7

data <- source_data("R/france-melodi.r") |> 
  pluck("aggr") |>
  filter(champ%in%c("mdhi")) |> 
  select(time, rb, rb2) |> 
  mutate(
    tp = glue(
      "<b>year(time)</b> France, Branches marchandes hors immobilier
      rendement (avant IS) du capital : {round(100*rb,1)}%
      rendement (avant IS) du capital, ratio CI/VA pour les serv. immo. de 1980 : {round(100*rb2,1)}%") )

data_long <- data |> 
  pivot_longer(c(rb, rb2))

gg <- ggplot(data_long) +
  aes(x=time, y=value) +
  geom_line(
    aes(linetype = name, color = name) ) +
  ggbraid::geom_braid(
    data = data,
    aes(y=NULL,ymin=rb2, ymax = rb), fill = "red", alpha=0.1) +
  scale_color_manual(
    values = c(rb="pink2", rb2 = "steelblue2"),
    aesthetics = c("fill", "color"),
    name = NULL, 
    labels = c(
      rb = "Rendement du capital productif, avant IS", 
      rb2 = "Rendement du capital productif, CI serv. immo. de 1980 (ratio), avant IS")) +
  scale_linetype_manual(
    values = c(rb2="11", rb = "solid"),
    name = NULL, 
    labels = c(
      rb = "Rendement du capital productif, avant IS", 
      rb2 = "Rendement du capital productif, CI serv. immo. de 1980 (ratio), avant IS")) +
  geom_point_interactive(
    data = ~.x |> filter(name=="rb"),
    aes(tooltip=tp, data_id = time, fill = name),
    hover_nearest = TRUE,
    shape = 21, stroke = 0.25, color = "white") +
  scale_y_continuous(labels = scales::label_percent(.1, decimal.mark = ",")) +
  labs(y="% du capital productif", x = NULL) +
  scale_ofce_date(
    labels = date1d) +
  ofce_caption(
    source="INSEE, comptes nationaux table des entrées sorties (CNA_SUT)"
  )+
  theme(
    legend.direction = "horizontal" )

girafy(gg)
```

{{< fa square >}}{style="text-align=center;"}

## Références {.unnumbered}

::: {#refs}
:::

::::::::::::: {.content-visible when-format="html"}
## Annexes {.unnumbered}

### Annexe A : derniers points connus {.unnumbered}

```{r}
doms <- source_data("R/vaq.r")$dom
pays <- source_data("R/nace.r")$pays3
emp_dom <- source_data("R/naq10_e.r")$dom
assets_dom <- source_data("R/assets.r")$dom
meta <- sourcoise::sourcoise_meta("R/vaq.r")
date <- meta$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

```

::: {#apptbl-data_trim}
```{r}

doms$snq |>
  rename(debq = deb, finq = fin) |>
  left_join(emp_dom, by = "geo") |> 
  rename(debs = deb, fins = fin) |> 
  left_join(doms$sna, by="geo") |> 
  rename(deba = deb, fina = fin) |> 
  left_join(doms$l68a, by = "geo") |> 
  rename(debl = deb, finl = fin) |> 
  left_join(assets_dom, by = "geo") |> 
  rename(debk = deb, fink = fin) |> 
  mutate(geo = factor(geo, pays)) |> 
  arrange(geo) |> 
  mutate(geo_lbl = lbl(geo),
         geo = countrycode::countrycode(geo, "eurostat", "iso2c")) |> 
  relocate(geo, geo_lbl) |> 
  gt() |> 
  fmt_flag(geo) |> 
  tab_spanner(label = md("**B1G, D1**<br>trim., niveau 1<br>namq_10_a10"), columns = c(debq, finq)) |> 
  tab_spanner(label = md("**SAL, NSAL**<br>an., niveau 2<br>nama_10_a64_e"), columns = c(debs, fins)) |> 
  tab_spanner(label = md("**P51C, D29x39, D51**<br>an., niveau 1<br>nama_10_a64"), columns = c(deba, fina)) |> 
  tab_spanner(label = md("**L68A**<br>an., niveau 2<br>nama_10_a64"), columns = c(debl, finl)) |> 
  tab_spanner(label = md("**N11N**<br>an., niveau 2<br>nama_10_nfa_st"), columns = c(debk, fink)) |> 
  cols_label(geo="", geo_lbl = "") |> 
  cols_label_with(
    columns = starts_with(c("deb", "fin")), 
    fn = ~ifelse(str_detect(.x, "deb"), "de", "à")) |> 
  cols_align('center', -c(geo, geo_lbl)) |> 
  cols_align('left', c(geo, geo_lbl))  |> 
  opt_interactive() |> 
  tab_options(table.font.size = 11) |> 
  cols_width(
      geo ~ px(30),
      geo_lbl ~ px(80),
      everything() ~ px(65)) |> 
  tab_source_note(md(glue("*Note* : données téléchargées sur le site d'Eurostat (package eurostat v4.0.0) le {date}, telles que publiées par Eurostat. Les instituts nationaux peuvent mettre à dispositon plus de données non (encore ?) prises en compte par Eurostat. Le niveau 1 compte 21 branches dont 19 marchandes. Le niveau 2 compte jusqu'à 99 branches, 47 sont utilisées pour les comptes de stock de capital productif."))) 
```

Premiers et derniers points connus par pays et par variables
:::

### Annexe B : CCF et actifs dans les différents pays {.unnumbered}

::: {#appfig-ccf}
```{r, results="asis"}
#| fig-asp: 0.85
naa <- source_data("R/vaq.r")$naaa |> 
  filter(geo %in% P6) |> 
  mutate(
    ccf = (vab-van)/vab,
    ccfina = (vab-van)/assets,
    assetsinva = assets/vab) |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)} 
    {champs[champ]}
    CCF dans la VAN : {round(ccf*100,1)}%
    CCF sur actifs productifs : {round(ccfina*100,1)}%
    actifs productifs sur VAB : {round(assetsinva*100,1)}%")) |>
  mutate(geo = factor(geo, P6))

date <- sourcoise::sourcoise_meta("R/vaq.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

labels_champ = c(tb = "Ttes branches", md="Marchand", mdhifi = "Marchand-LK",
                 mdhim = "Marchand-L68A",
                 mdhi = "Marchand-L")
ilc <- set_names(names(labels_champ), labels_champ)

ccfs <- imap(
  ilc,
  ~ggplot(naa |> filter(champ == .x)) +
    aes(x=time, y=ccf, col = geo, group = geo) +
    geom_line(color = "grey80", layout = "fixed", linewidth = 0.2) +
    geom_line(linewidth= 0.5) +
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = geo),
      size = 1, stroke = 0.2, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d ) +
  guides( fill = "none", color = "none",
          linetype = guide_legend(nrow = 1),
          alpha = guide_legend(nrow = 1)) + 
  scale_y_continuous(
    labels = scales::label_percent(1), 
                     breaks = scales::pretty_breaks(5),
                     limits = c(0, 0.25)) +
  scale_color_pays(format = "eurostat") +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}, code à github.com/xtimbeau/travail/R/vaq.r.",
    champ = "Branches marchandes {.y}.",
    note = "La CCF provient des comptes annuels, jusqu'en 2023 ou 2024 selon les pays (voir tableau A1). Les traits colorés correspondent à chaque pays, les traits fins gris rappellent les autres pays.") ) 

tabsetize(ccfs, 1.25)
```

CCF dans la valeur ajoutée
:::

::: {#appfig-ccfina}
```{r, results="asis"}
#| fig-asp: 0.85

ccfsina <- imap(
  ilc,
  ~ggplot(naa |> filter(champ == .x) |> drop_na(ccfina)) +
    aes(x=time, y=ccfina, col = geo, group = geo) +
    geom_line(color = "grey80", layout = "fixed", linewidth = 0.2) +
    geom_line()+
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = geo),
      size = 1, stroke = 0.2, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d ) +
  guides( fill = "none", color = "none",
          linetype = guide_legend(nrow = 1),
          alpha = guide_legend(nrow = 1)) + 
  scale_y_continuous(
    labels = scales::label_percent(1), 
                     breaks = scales::pretty_breaks(5),
                     limits = c(0, 0.15)) +
  scale_color_pays(format = "eurostat") +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}, code à github.com/xtimbeau/travail/R/vaq.r.",
    champ = "Branches marchandes {.y}.",
    note = "La CCF provient des comptes annuels, jusqu'en 2023 ou 2024 selon les pays, extrapolée au delà (voir tableau A1). Les traits colorés correspondent à chaque pays, les traits fins gris rappellent les autres pays.") ) 

tabsetize(ccfsina, 1.25)
```

CCF rapportée aux actifs
:::

::: {#appfig-assetva}
```{r, results="asis"}
#| fig-asp: 0.85

ccfsina <- imap(
  ilc,
  ~ggplot(naa |> filter(champ == .x) |> drop_na(ccfina)) +
    aes(x=time, y=assetsinva, col = geo, group = geo) +
    geom_line(color = "grey80", layout = "fixed", linewidth = 0.2) +
    geom_line()+
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = geo),
      size = 1, stroke = 0.2, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d ) +
  guides( fill = "none", color = "none",
          linetype = guide_legend(nrow = 1),
          alpha = guide_legend(nrow = 1)) + 
  scale_y_continuous(
    labels = scales::label_percent(1), 
                     breaks = scales::pretty_breaks(5),
                     limits = c(0, NA)) +
  scale_color_pays(format = "eurostat") +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}, code à github.com/xtimbeau/travail/R/vaq.r.",
    champ = "Branches marchandes {.y}.",
    note = "La CCF provient des comptes annuels, jusqu'en 2023 ou 2024 selon les pays, extrapolée au delà (voir tableau A1). Les traits colorés correspondent à chaque pays, les traits fins gris rappellent les autres pays.") ) 

tabsetize(ccfsina, 1.25)
```

Actifs productifs sur VAB
:::

### Annexe C : Différents concepts et champs de part des salaires {.unnumbered}

::: {#appfig-psalcompote}
```{r}
#| fig-asp: 1

data <- naq |> 
  filter(geo %in% P6) |> 
  filter(time>="1995-01-01") |>
  select(geo, time, champ, psal, psalnc, psalb, psalncb) |> 
  pivot_longer(c(psal, psalnc, psalb, psalncb)) |> 
  mutate(name = factor(name, c("psal", "psalb", "psalnc", "psalncb")),
         champ = factor(champ, c("tb", "md", "mdhi", "mdhim", "mdhfi", "mdhimfi", "mdhifi")))

strips_name <- c(psal = "Nette, avec n.s.",
                psalnc = "Nette, sans n.s.",
                psalb = "Brute, avec n.s.",
                psalncb = "Brute, sans n.s.")
strips_champ <- c(tb = "Ttes branches",
                md = "Marchand",
                mdhi = "hors imm.",
                mdhim = "hors loy. imp.",
                mdhimfi = "hors fin.&loy. imp.",
                mdhfi = "hors fin.",
                mdhifi = "hors imm.&fin.")

gg <- ggplot(data) +
  aes(x=time, y = value, color = geo) + 
  geom_line_interactive(
    aes(tooltip = lbl(geo), data_id = geo),
    linewidth = 0.25,
    show.legend = FALSE, hover_nearest = TRUE) +
   facet_grid(rows=vars(champ), cols = vars(name),
             labeller = labeller(name= strips_name, champ = strips_champ)) + 
  scale_y_continuous(labels = scales::label_percent(1),
                     breaks = scales::breaks_pretty(n=3)) +
  scale_ofce_date(
    labels = date1d
    ) +
  ylab("% de la VA") +
  scale_color_pays("eurostat") +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}, code à github.com/xtimbeau/travail/R/vaq.r.")

girafy(gg, 1.25)
```

Part des salaires dans la VA, tous concepts, comparaison entre pays
:::

::: {#apptbl-rang}
```{r, results="asis"}

tt <- imap(strips_champ, ~{
  source_data("R/vaq.r")$naa |> 
    filter(time == "2023-01-01", champ == .y) |> 
    select(geo, time, champ, psal, psalnc, psalb, psalncb) |> 
    pivot_longer(c(psal, psalnc, psalb, psalncb)) |>
    group_by(name) |> 
    mutate(rank = rank(-value),
           geo_lbl = lbl(geo),
           geo = countrycode(geo, "eurostat", "iso2c")) |> 
    arrange(geo) |> 
    pivot_wider(names_from = c(name), values_from = c(value, rank)) |> 
    relocate(geo, geo_lbl) |> 
    arrange(desc(value_psal)) |> 
    gt() |> 
    cols_hide(c(time, champ)) |> 
    tab_spanner(label = "Part des salaires dans la VA en 2023", columns = starts_with("value") ) |> 
    tab_spanner(label = "Rang en 2023", columns = starts_with("rank") ) |> 
    cols_label_with(starts_with("value"), ~strips_name[[str_remove(.x, "value_")]] ) |> 
    cols_label_with(starts_with("rank"), ~strips_name[[str_remove(.x, "rank_")]] ) |> 
    gt::fmt_flag(geo) |> 
    fmt_percent(starts_with("value"),decimals = 1) |> 
    cols_label(geo = "", geo_lbl = "") |> 
    opt_interactive() |> 
    tab_options(table.font.size = 12) |> 
    cols_width(
      geo ~ px(30),
      geo_lbl ~ px(90),
      TRUE ~ px(60)
    )
}) 

names(tt) <- strips_champ

tabsetize(tt)
```

Part des salaires dans la VA et rang, différents concepts
:::

### Annexe D : Rémunération des non salariés {.unnumbered}

::: {@appfig-mixte}
```{r, results="asis"}
#| fig-asp: 0.85 
PA <- source_data("R/nace.r")$pays2 
anD <- source_data("R/annexeD.r") |> 
  mutate(
    reff = self/sal,
    reffh = selfh/salh,
    rb3g = b3g/d1, 
    rb3n = ifelse(geo=="FR", b3n/d1, 0.88*b3g/d1),
    rwpc = w,
    across(c(reff, reffh, rb3n), ~.x/reff, .names = "{.col}pc")) |> 
  relocate(geo, time, champ, starts_with("r")) |> 
  filter(geo %in% PA) |> 
  mutate(geo = factor(geo, PA),
         tooltip = glue(
         "<b>{lbl(geo)}</b>
         Part des non salaries, toutes branches, selon :
           - les effectifs : {round(reff*100, 1)}%
           - les heures travaillées : {round(reffh*100, 1)}%
           - le revenu (b3n/d1) : {round(rb3n*100, 1)}%
           - le revenu (egalisé) issu de EU-SILC : : {round(rb3n*100, 1)}"))

date <- sourcoise::sourcoise_meta("R/annexeD.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

data <- anD |> 
  filter(champ == "tb") |>
  select(geo, time, tooltip, reff, reffh, rb3n) |> 
  pivot_longer(-c(geo, time, tooltip), names_to = "concept") |> 
  mutate(
    concept = factor(concept, c("reff", "reffh", "rb3n")),
    principal = concept == "reff") |> 
  filter(time>="1995-01-01")

datapc <- anD |> 
  filter(champ == "tb") |>
  select(geo, time, tooltip, reffpc, reffhpc, rb3npc, rwpc) |>
  rename_with(.fn = ~str_remove(.x, "pc$"), .cols = starts_with("r")) |> 
  pivot_longer(-c(geo, time, tooltip), names_to = "concept") |> 
  mutate(
    concept = factor(concept, c("reff", "reffh", "rb3n", "rw")),
    principal = concept== "rb3n") |> 
  filter(time>="1995-01-01")

labels <- c(reff = "Effectifs", reffh = "Heures", rb3n = "Revenu mixte", rw = "Revenu EU-SILC")

gD <-imap(
  list("Agrégé" = data, "Par tête" = datapc), 
  ~ ggplot(.x) +
  aes(x=time, y=value, col = geo, group = concept, 
      linewidth = concept, linetype = concept, alpha = concept) +
  geom_line()+
  geom_point_interactive(
    data = ~filter(.x, principal),
    aes(tooltip = tooltip, data_id = time, fill = geo),
    size = 1, stroke = 0.5, shape = 21, color = "white",
    hover_nearest = TRUE, show.legend=FALSE) +
  ylab(NULL) + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl, scales = "free_y") +
  scale_ofce_date(
    labels = date1d) +
  scale_alpha_manual(
    values = c(reff = 1, reffh = 0.5, rb3n = 1, rw = 0.5),
    labels = labels,
    name = NULL) +
  scale_linewidth_manual(
    values = c(reff = 0.25, reffh = 0.5, rb3n = 0.25, rw =0.5),
    labels = labels,
    name = NULL) +
  scale_linetype_manual(
    values = c(reff = "solid", reffh = "11", rb3n = "solid", rw = "12"),
    labels = labels,
    name = NULL) +
  guides( 
    fill = "none", color = "none",
    linetype = guide_legend(nrow = 1),
    alpha = guide_legend(nrow = 1)) + 
  scale_y_continuous(
    labels = scales::label_percent(1), 
    breaks = scales::pretty_breaks(3)) +
  scale_color_pays(format = "eurostat") +
  ofce_caption(
    note = "Les échelles de chaque pays sont ajustées et donc différentes.",
    source = "Eurostat, comptes nationaux annuels de secteur (nasa_10_nf_tr), emploi (nama_10_a64_e), EU-SILC (ilc_di05), téléchargés le {date}, code à github.com/xtimbeau/travail/R/annexeD.r.",
 champ = "Toutes branches.") )

tabsetize(gD, r = 1.5)
```

Différentes mesures du revenu des non salariés
:::

::: {#appfig-mixtefr}
```{r, results="asis"}
#| fig-asp: 0.85 
anD <- source_data("R/annexeD.r") |> 
  filter(geo == "FR", champ %in% c("tb", "md", "mdhi")) |> 
  mutate(
    reff = self/sal,
    reffh = selfh/salh,
    rb3n = b3n/d1,
    rb3npc = b3n/self/(d1/sal)) |> 
  relocate(geo, time, champ, starts_with("r")) |> 
  mutate(tooltip = glue(
         "<b>France</b>
         {champs[champ]} 
         Part des non salaries, selon :
           - les effectifs : {round(reff*100, 1)}%
           - les heures travaillées : {round(reffh*100, 1)}%
           - le revenu (b3n/d1) : {round(rb3n*100, 1)}%")) |> 
  select(time, champ, reff, reffh, rb3n, rb3npc, tooltip) |> 
  pivot_longer(c(reff, reffh, rb3n, rb3npc), names_to = "concept") |> 
  mutate(principal = concept == "md")

date <- sourcoise::sourcoise_meta("annexeD.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

labels <- c(reff = "Effectifs", reffh = "Heures", rb3n = "Revenu mixte", rw = "Revenu EU-SILC")

gD2 <-imap(
  c("Effectifs" = "reff", "Heures" = "reffh", "Revenu mixte" = "rb3n", "Revenu mixte par tête" = "rb3npc"),   ~ {
    data <- anD |> 
    filter(concept == .x) |>
    select(time, champ, value, tooltip, principal) |> 
    mutate(
      champ = factor(champ, c("tb", "md", "mdhi")),
      principal = champ == "md") |> 
    filter(time>="1995-01-01")
  labels <- c(md = "Marchandes", 
              tb = "Toutes branches", 
              mdhi = "Marchandes hors immo.")
  ggplot(data) +
    aes(x=time, y=value, col = champ, group = champ, 
        linewidth = champ, linetype = champ) +
    cols4all::scale_color_discrete_c4a_cat(
      "tableau.10", name = NULL,
      labels = labels) +
    cols4all::scale_fill_discrete_c4a_cat("tableau.10") +
    geom_line()+
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = champ),
      size = 1, stroke = 0.5, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
  ylab(NULL) + xlab(NULL) +
  scale_ofce_date(
    labels = date1d) +
  scale_linewidth_manual(
    values = c(tb = 0.25, md = 0.5, mdhi = 0.25),
    labels = labels,
    name = NULL) +
  scale_linetype_manual(
    values = c(tb = "11", md = "solid", mdhi = "solid"),
    labels = labels,
    name = NULL) +
  guides(fill = "none") + 
  scale_y_continuous(
    labels = scales::label_percent(1), 
    breaks = scales::pretty_breaks(3)) +
    theme(legend.direction = "horizontal") +
  ofce_caption(
    source = "INSEE, téléchargés le {date}, code à   github.com/xtimbeau/travail/R/annexeD.r.",
 champ = "voir légende") 
  })

tabsetize(gD2, r = 1.5)
```

Différentes mesures du revenu des non salariés
:::

### Annexe E : Part des salaires dans la VA, base 2020 et 2014 depuis 1949 {.unnumbered}

::: {#fig-psalfr49}
```{r, results="asis"}
#| fig-asp: 0.85

cn14 <- source_data("R/france CN 2014.R") |> 
  select(time, champ, psal, starts_with("na"))
cn20 <- source_data("R/france-melodi.r")$aggr |> 
  select(time, champ, psal = psalm, psalc)

champs  <- c("md" = "Marchand", 
             "mdhifi" = "Marchand hors immobilier et services financiers",
            "mdhi"= "Marchand hors services immobiliers", 
            "mdhfi"= "Marchand hors services financiers", 
            "tb" = "Toutes branches (marchandes et non marchandes)")

data <- full_join(cn14, cn20, by=c("time", "champ"), suffix = c(".14", ".20")) |>
  mutate(
    across(starts_with("na"), ~replace_na(.x, FALSE)),
    na = naccf | nab3g | nad29 | nad39,
    tooltip = glue(
      "<b>{year(time)}</b>
      Part des salaires dans la VAN, correction par le revenu mixte (voir note)
      CNA 2020 : {round(psal.20*100,1)}%
      CNA 2014 : {round(psal.14*100,1)}%" ) ) |> 
  pivot_longer(c(psal.20, psal.14, psalc))

psalE <- imap(
  c("Marchand" = "md",
    "Hors immo." = "mdhi", 
    "Hors  fi." = "mdhfi",
    "Hors immmo.&fin." = "mdhifi",
    "Marchand et non marchand" = "tb"),
  ~ggplot(data |> filter(champ == .x)) +
    aes(x=time, y=value, col = name, group = name, linewidth  = na) +
    geom_line() +
    scale_linewidth_manual(values = c(0.75, 0.25 )) +
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = name),
      size = 1, stroke = 0.5, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
    ylab("% de la VA") + xlab(NULL) +
    scale_ofce_date(
      labels = date1d) +
    guides( fill = "none") +
    PrettyCols::scale_color_pretty_d(
      "Joyful",
      name = NULL,
      labels = c(psal.14 = "CNA 2014", psalc = "CNA 2014 (b3g)", psal.20 = "CNA 2020")) +
    theme(legend.direction = "horizontal") +
    scale_color_manual(values = c(psal.14 = bluish, psalc = colorspace::lighten(bluish, 0.1), psal.20 = redish),
                       aesthetics = c("color", "fill")) +
    scale_y_continuous(
      labels = scales::label_percent(1), 
      breaks = scales::pretty_breaks(5)) +
    guides(linewidth = "none") +
    ofce_caption(
      source = "INSEE, comptes nationaux annuels base 2014 (de 2022) et base 2020 (de 2025), code à github.com/xtimbeau/travail/france CN 2014.r.",
      champ = "Branches {tolower(.y)}.",
      note = "La construction de la part des salaires de 1949 à 1978 demande la rétropolation de la CCF (P51C), des subventions (D29) et impôts à la production (D39) à partir de la valeur ajoutée brute ainsi que du revenu mixte à partir des effectifs salariés et non salariés.") ) 

tabsetize(psalE, r = 1.25, active = 2)

```

Part des salaires en France 1949-2025
:::

### Annexe F : Taux de rendement du catipal productif en France, 1978-2024

::: {#fig-rfr78}
```{r, results="asis"}
#| fig-asp: 0.85

cn20 <- source_data("R/france-melodi.r")$aggr |> 
  select(time, champ, rb, rbm) |> 
  drop_na(rb)

champs  <- c("md" = "Branches marchandes", 
             "mdhifi" = "Branches marchandes hors services immobiliers et financiers",
            "mdhi"= "Branches marchandes hors services immobiliers", 
            "mdhfi"= "Branches marchandes hors services financiers", 
            "tb" = "Toutes branches (marchandes et non marchandes)")

data <- cn20 |>
  mutate(
    tooltip = glue(
      "<b>{year(time)}</b>
      Rendement du capital productif, 
      Correction par les effectifs : {round(rb*100,1)}%
      Correction par le revenu mixte : {round(rbm*100,1)}%" ) ) |> 
  pivot_longer(c(rb, rbm))

psalE <- imap(
  c("Marchand" = "md",
    "Hors immo." = "mdhi", 
    "Hors  fi." = "mdhfi",
    "Hors immmo.&fin." = "mdhifi",
    "Marchand et non marchand" = "tb"),
  ~ggplot(data |> filter(champ == .x)) +
    aes(x=time, y=value, col = name, group = name) +
    geom_line() +
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = name),
      size = 1, stroke = 0.5, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
    ylab("% des actifs productifs") + xlab(NULL) +
    scale_ofce_date(
      labels = date1d) +
    guides( fill = "none") +
    theme(legend.direction = "horizontal") +
    scale_color_manual(values = c(rb = bluish, rbm = redish),
                       aesthetics = c("color", "fill"),
                       name = NULL,
                       labels = c(rb = "Correction effectifs", rbm = "Correction revenu mixte")) +
    scale_y_continuous(
      labels = scales::label_percent(1), 
      breaks = scales::pretty_breaks(5)) +
    ofce_caption(
      source = "INSEE, comptes nationaux annuels base 2020, code à github.com/xtimbeau/travail/france-melodi.r.",
      champ = "{champs[.x]}",
      note = "Le rendement du capital productif est défini comme le profit net de la CCF avant impôt sur les sociétés et après impôts et suvention à la production divisé par la valeur au coût de remplacement des actifs produits (N11N).") ) 

tabsetize(psalE, r = 1.25, active=2)

```

Taux de rendement du catipal productif en France, 1978-2024
:::
:::::::::::::

::: {.content-visible when-format="pdf"}
## Suppléments {#fappfig-psalcompote .unnumbered}

6 annexes sont accessibles en ligne à l'adresse <https://xtimbeau.github.io/travail/> :

-   annexe A : Domaine des données,
-   annexe B : CCF,
-   annexe C : comparaisons entre pays,
-   annexe D : rémunération des non salariés,
-   annexe E : CN2020 et CN2014 pour la France,
-   annexe F : Rendement du capital productif de 1978 à 2024)
:::
