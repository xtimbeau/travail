---
title: "Part des salaires dans la valeur ajoutée"
author:
  - name: "Xavier Timbeau" 
    email: "xavier.timbeau@sciencespo.fr"
    affiliation: OFCE, Sciences Po Paris
    affiliation-url: "http://www.ofce.fr"
    orcid: "0000-0002-6198-5953"
editor: visual
date: "2025-09-08"
date-modified: now
bibliography: references.bib
echo: false
message: false
warning: false

format:
  ofce-html:
    code-links:
      - text: Salaires dans la VA
        icon: file-code
        href: vaq.r
      - text: Salaires trimestriels
        icon: file-code
        href: salaires.r
      - text: Comptes des SNF (s11)
        icon: file-code
        href: snf_ratio.r
      - text: SNF (coop. inter. Eurostat)
        icon: file-code
        href: snf_international.r
      - text: SNA (OCDE)
        icon: file-code
        href: oecd.r
      - text: Emploi salarié et non salarié
        icon: file-code
        href: naq10_e.r
      - text: NACE rev2
        icon: file-code
        href: nace.r
---

```{r, include=FALSE}
ofce::init_qmd()
thm <- theme_ofce(marquee=TRUE,
  panel.spacing = unit(9, "point"),
  axis.text = element_text(size=rel(0.7)),
  strip.text = element_marquee(size = rel(0.75)),
  legend.position = "bottom",
  legend.justification = "center")
```

## Du partage de la VA au partage des richesses

L'analyse du partage de la valeur ajoutée est au cœur des débats sur la redistribution des richesses. Un indicateur souvent retenu est celui de la part des salaires dans la valeur ajoutée. Nous discutons ici de la construction de cet indicateur et de sa comparabilité entre pays (européens ou non). Trois points sont importants pour disposer du bon concept :

-   Corriger des non salariés et leur imputer une masse salariale. Cette correction est standard. Elle repose sur des hypothèses importantes comme le salaire affecté à un non salarié. Nous utilisons la décomposition en branches (ou en secteurs dans certains pays) pour affecter aux non salariés d'une branche le salaire moyen des salariés de cette branche. C'est une hypothèse assez forte, mais qu'il est difficile de dépasser. Elle a des conséquences pour les comparaisons entre périodes pour un même pays parce que la part des non salariés varie dans le temps, de façon différente suivant les branches et entre pays.

-   Définir le champ considéré. Il est plus facile de faire le calcul au niveau le plus agrégé, mais ce champ inclut les branches non marchandes dans lesquelles la notion de prix et donc de valeur ajoutée est parfois conventionnelle. Parmi les branches marchandes, la branches des services immobiliers est problématique parce qu'elle prend en compte la valeur ajoutée des ménages au travers des services immobiliers qui sont pour par auto produit (les loyers imputés aux propriétaires). La notion de partage de la valeur ajoutée n'a ici pas beaucoup de sens et la comparaison d'un pays à l'autre peut être très perturbée. La notion provilégiée est donc celle de partage de la valeur ajoutée dans les branches marchandes hors services immobiliers.

-   Utiliser la notion de valeur ajoutée nette (de la CCF) plutôt que brute. Rappelons que la valeur ajoutée nette est construite en ôtant de la valeur ajoutée brute la consommation de capital fixe. Cette dernière notion découle de l'application de tables de mortalité à un inventaire permanent des investissements non financiers (i.e. les investissements physiques mais aussi ceux en logiciels ou en base de données ainsi que les investissements intangibles comme les marques). En traitant les investissements comme une consommation intermédiaire par leur amortissement, on est plus proche de la réalité du processus productif. Lorsque le taux de dépréciation du capital varie, par des changement dans les tables de mortalité, des changements dans la composition du capital ou des changements dans la structure par branche de l'économie, la CCF rapprotée à la valeur ajoutée varie et modifie donc la perception des évolutions du partage de la valeur ajoutée. La notion de valeur ajoutée nette est meilleure pour des comparaisons dans l'espace ou dans le temps. Comme pour la correction pour les non salariés, la prise en compte de la valeur ajoutée nette modifie dans le temps et dans l'espace la part des salaires dans la valeur ajoutée.

```{r}
#| label: fig-psal
#| fig-asp: 1
#| fig-cap: Part des salaires dans la VA nette

champs  <- c("md" = "Marchand", "mdhifi" = "Marchand hors immobilier et services financiers",
            "mdhi"= "Marchand hors services immobiliers", 
            "mdhfi"= "Marchand hors services financiers", 
            "tb" = "Toutes branches (marchandes et non marchandes)")
naq <- source_data("vaq.r")$naa |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)} 
    {champs[champ]}
    Rémunérations (y.c. les non salariés) dans la VAN : {round(psal*100,1)}%")) |>
  mutate(geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE")))

date <- sourcoise::sourcoise_meta("vaq.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

annot <-  tribble(
    ~time, ~psal, ~label, ~geo, ~champ,
    "1996-01-01", .89, "Branches marchandes hors immobilier et finance", "DE", "mdhifi",
    "1996-01-01", .61, "Branches marchandes et non marchandes", "DE", "tb") |> 
  mutate(time = as.Date(time),
         geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE")))

labels_champ = c(tb = "Ttes branches", md="Marchand", mdhifi = "Marchand hors imm.&fin.",
                 mdhi = "Marchand hors imm.")

psal <- ggplot(naq |> filter(champ %in% c("mdhi"))) +
  aes(x=time, y=psal, col = geo, group = geo) +
  geom_line(color = "grey85", layout = "fixed", linewidth = 0.2) +
  geom_line_interactive(
    aes(tooltip = "Part des salaires dans la VAN,<br>corrigée de la non salarisation,<br>branches marchandes hors immobilier"),
    linewidth = 0.5) +
  geom_point_interactive(
    aes(tooltip = tooltip, data_id = time, fill = geo),
    size = 1, stroke = 0.2, shape = 21, color = "white",
    hover_nearest = TRUE, show.legend=FALSE) +
#  geom_marquee(
#    data = annot, hjust = 0, 
#    aes(label = label),  size = 6, size.unit = "pt", show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d ) +
  guides( fill = "none", color = "none",
          linetype = guide_legend(nrow = 1),
          alpha = guide_legend(nrow = 1)) + 
  scale_y_continuous(
    labels = scales::label_percent(1), 
                     breaks = scales::pretty_breaks(5),
                     limits = c(NA, NA)) +
  scale_color_pays(format = "eurostat") +
  thm +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}.",
    code =  "github.com/xtimbeau/travail/vaq.r",
    champ = "Branches marchandes hors services immobiliers (L dans la NACE r2).",
    note = "La CCF provient des comptes annuels, jusqu'en 2023 ou 2024 selon les pays, extrapolée au delà.")

girafy(psal, 1.5)
```

La part des salaires dans la valeur ajoutée nette est croissante en France (@fig-psal) (de 10 points de 1998 à 2025), comme en Espagne (de 9 points). Elle atteint en France le niveau le plus élevé des pays sélectionnés, pour autant que l'on puisse comparer entre pays. La part des salaires dans la valeur ajoutée est la plus basse aux Pays-Bas et est sur une pente décroissante depuis plus de 20 ans, alors qu'elle semble stable en Belgique et en Allemagne. L’Italie affiche une variabilité temporelle importante.

Elle est cependant stable en France depuis 2020 (voire légèrement décroissante). Ce même mouvement s'observe dans les autres pays, plus nettement. La phase d'inflation à partir de 2022 a induit une moindre indexation des salaires (voir @fig-salaires) puis un rattrapage. Ce profil général a pris néanmoins des tournures assez différentes d'un pays à l'autre. La déflation salariale a plutôt été plus limité en France, conduisant à une hausse de la part des salaires, alors qu'elle a été très marquée aux Pays-Bas – sans doute aussi par des effets de la crise énergétique différents entre pays, sans compter des questions de mesure des indices de prix qui peuvent rendre difficile les comparaisons. Mais au-delà des problèmes de mesures, la part des salaires est plus volatile aux Pays-Bas qu'en France, ce qui tend à montrer que la dépréciation réelle des salaires c'est fait aux Pays-Bas à l'avantage des firmes.

Au début des années 2000, deux pays se distinguaient des autres (l'Espagne et l'Italie) par une part des salaires plus faibles. L'écart avec l'Allemagne atteignait alors plus de 15 points. Moins développés, une part peut être plus importante de l'investissement expliquait cette situation. La généralisation de l'approche à d'autres pays de l'Union Européenne permettrait de confirmer cette hypothèse. Aujourd'hui la situation est différente, l'écart entre l'Allemagne et ces pays s'étant drastiquement réduit (moins de 8 points entre l'Italie et l'Allemagne) et les Pays-Bas prenant la place du pays où la part des salaires est la plus basse et la France où elle est nettement plus haute.

On détaille dans la suite de ce document les effets des corrections appliquées, ainsi que la différence entre les mesures dérivées des comptes de branche ou des comptes d'agents. Ces éléments sont un peu fastidieux, mais ils s'avèrent assez importants et pas toujours très intuitifs.

On explore également les conséquences en matière de taux de profit (part des profits nets dans la valeur ajoutée) ou rendement du capital (profits nets divisés par les actifs).

## Evolution des salaires réels

L'évolution des salaries réels est un complément à celle du partage de la valeur ajoutée. Par passer de l'un à l'autre, il faut non seulement prendre en compte les évolutions de la valeur ajoutée, mais aussi les effets de l'évolution du ratio prix à la consommation sur prix de valeur ajoutée.

On déflate la masse salariale (comptabilité nationale, comptes trimestriels) par les prix à la consommation. On utilise les masses salariales ($D1$, dans [`namq_10_a10`](https://ec.europa.eu/eurostat/databrowser/view/NAMQ_10_A10/default/table?lang=en)) par branches pour comparer branches (principalement) marchandes et (principalement) non marchandes divisées par l'emploi salarié ([`namq_10_a10_e`](https://ec.europa.eu/eurostat/databrowser/view/NAMQ_10_A10_E__custom_7475124/default/table?lang=en)). Les prix sont les déflateurs de la consommation ($P31\_S14$ dans [`namq_10_fcs`](https://ec.europa.eu/eurostat/databrowser/product/page/NAMQ_10_FCS)) chaînés (voir le code pour les détails).

On distingue 4 agrégations : l'ensemble des branches (ou l'ensemble de l'économie), les branches non marchandes, les branches marchandes et les branches marchandes hors immobilier.

```{r}
#| label: fig-salaires
#| fig-cap: Salaires réels en Europe
#| fig-asp: 1

library(lubridate)

salaires <- source_data('salaires.r') |> 
  mutate(tooltip = glue(
  "<b>{lbl(geo)}</b>
  {date_trim(time)}
  Salaire nominal : {round(w,1)} k€ courants
  Salaire réel : {round(wr,1)} k€ 2023"))
meta <- sourcoise::sourcoise_meta("salaires.r")
date <- meta$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")
data <- salaires |> 
  filter(time >= "1995-01-01") |> 
  select(geo, time, wr, wr_md, wr_nmd, wr_hi) |> 
  mutate(
    tooltip = glue(
    "<b>{lbl(geo)}</b>
    {date_trim(time)}</b>
    Salaire réel, toute l'économie {round(wr,1)} k€/an
    Salaire réel, branches marchandes {round(wr_md,1)} k€/an
    Salaire réel, branches marchandes hors imm. {round(wr_hi,1)} k€/an
    Salaire réel, branches non marchandes {round(wr_nmd,1)} k€/an")) |> 
  pivot_longer(c(wr, wr_md, wr_nmd, wr_hi)) |> 
  mutate(geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE")))

labels_branches <- c(wr = "Ttes branches", wr_md = "Marchand", 
                     wr_nmd = "Non marchand", wr_hi = "Marchand hors imm.")
sal <- ggplot(data) +
  aes(x=time, y=value, 
      alpha = name, linewidth = name, linetype = name,
      color = geo) +
  scale_alpha_manual(
    values = c(wr=1, wr_md = 1, wr_nmd = 0.75, wr_hi = 0.75),
    labels = labels_branches, name = NULL) +
  scale_linetype_manual(
    values = c(wr="solid", wr_md ="solid", wr_nmd ="solid", wr_hi = "11"),
    labels = labels_branches,
    name = NULL) +
  scale_linewidth_manual(
    values = c(wr=.5, wr_md = 0.1, wr_nmd = 0.25, wr_hi= 0.5),
    labels = labels_branches, name = NULL) +
  geom_point_interactive(
    data = ~.x |> 
      filter( name == "wr") |>  
      group_by(geo) |>
      filter(quarter(time) == last(quarter(time))) |>
      ungroup(),
    aes(tooltip = tooltip, data_id = time),
    size = 0.2, stroke = 0, hover_nearest = TRUE) +
  geom_line_interactive(
    aes(tooltip  = labels_branches[name])) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(labels = date1d) +
  ylab("Salaire annuel réel en k€") + xlab(NULL) +
  scale_y_log10(breaks = c(10, 20, 30, 40, 50, 50, 60)) +
  scale_color_pays(format = "eurostat") +
  thm +
  theme(
    legend.direction = "horizontal") +
  guides(color = "none", fill="none") +
  ofce_caption(
    wrap = 0,
    source = "Eurostat, comptes nationaux trimestriels de branche (namq_10_a10), téléchargé le {date},
    calcul de l'auteur.",
    dpt = salaires$time,
    dptf = "quarter",
    code =  "github.com/xtimbeau/travail/salaires.r",
    champ = "Toute l'économie, salaires y compris cotisations sociales à la charge de l'employeur.",
    note = "Le salaire est défini comme la masse salariale divisée par l'emploi salarié, sur les 4 derniers trimestres, déflaté par le déflateur de la consommation chaîné.",
    ofce = FALSE)

girafy(sal, 1)

```

En Italie et en Espagne, la masse salariale dans les branches non marchandes est supérieures à celle des branches non marchandes. Aux Pays-Bas et en Allemagne il n'y a pas de différence notable. En France, elle est significativement plus basse. Notons que les branches non marchandes ne sont pas nécessairement de l'emploi public et ce dans des proportions variables suivant les pays. Dans tous les pays, la masse salariale des branches immobilier et (surtout) services financiers est plus élevée que la masse salariale dans les autres branches marchandes.

## Part des salaires dans la valeur ajoutée, comptes de branche

On utilise les données de comptabilité nationale, en trimestriel, par branche ([`nasq_10_nf_tr`](https://ec.europa.eu/eurostat/databrowser/view/nasq_10_nf_tr/default/table?lang=en)), ré-agrégées au niveau de l'ensemble de l'économie. Le passage par les comptes de branches permet de distinguer branches marchandes et non marchandes ou d'autres regroupements, comme l'exclusion des services immobiliers. Ce passage permet également de conduire la correction salariés non salariés au niveau des branches. D'après l'INSEE, (voir le blog "[Combien pèse l'industrie en France et en Allemagne](https://blog.insee.fr/combien-pese-l-industrie-en-france-et-en-allemagne/)"), tous les pays ne produisent pas une comptabilité de branche mais pour certains (notamment l'Allemagne) une comptabilité sectorielle. La différence tient aux entreprises qui produisent plusieurs produits (un constructeur automobile propose des services financiers pour l'achat des véhicules) et dont l'activité est imputé à différentes branches (industrie et services financiers) dans la comptabilité de branche alors que dans une comptabilité de secteur l'acitvité est versée dans le principal secteur (ou le secteur d'immatriculation de l'entreprise chapeau). Cette différence empêche normalement les comparaisons des comptes de branches entre pays, y compris à l'intérieur de l'Union Européenne. Cependant, pour comparer la part des salaries dans la valeur ajoutée sur des agrégats larges (branches marchandes par exemple), cette dérogation à la norme comptable n'est que modérément problématique : de toute façon, l'automobile et les services financiers sont agrégés et c'est la correction pour la masse salariale des non salariés qui peut être modifiée. Mais si la même délimitation est employée pour les salariés et les non salariés que pour l'activité, l'erreur est probablement minime.

La part des salaires est corrigée de la part des non salariés (données annuelles [`nama_10_a64_e`](https://ec.europa.eu/eurostat/databrowser/view/nama_10_a64_e/default/table?lang=en), extrapolées en maintenant le ratio salariés/non salariés à sa dernière valeur observée) en considérant que le salaire des non salariés est identique dans chaque branche à celui des salariés – cette hypothèse sous estime probablement le salaire des non salariés mais elle est difficile à lever, sauf à utiliser les enquêtes force de travail et faire confiance aux revenus qui y sont déclarés, en perdant la variation d'une année à l'autre. En revanche, on prend bien en compte que les non salariés de la branche agricole n'ont pas le même revenu que ceux de la branche "information et communication". La décomposition employée est à 9 branches et on peut conduire la même correction à un niveau de désaggrégation plus fin.

La masse salariale est rapportée soit à la valeur ajoutée brute ($B1G$), soit à la valeur ajoutée nette ($B1N=B1G-P51C$). Comme la consommation de capital fixe ($P51C$) n'est pas connue en trimestriel, elle est dérivée des comptes annuels en 21 branches (niveau 1 de la nace rev2 [`nama_10_a64`](https://ec.europa.eu/eurostat/databrowser/view/nama_10_a64/default/table?lang=en)), agrégée en 9 branches, puis extrapolée pour les années non connues (ici 2024 et 2025) en conservant un ratio constant dans la valeur ajouté brute. Le détail se trouve dans le code.

Les trois graphiques suivants illustrent les conséquences sur la mesure de la part des salaires suivant les différents concepts. Le @fig-psalcnc compare avec et sans correction pour les non salariés. Deux rubans sont affichés, l'un pour les branches marchandes hors services immobiliers et financiers et l'autre pour toutes les branches.

L'avantage des comptes de branches est une définition homogène pour chacun des pays. La branche immobilier est exclue parce qu'il est impossible de distinguer les entreprises des ménages propriétaires (les loyers imputés sont une valeur ajoutée des ménages).

Les données trimestrielles sont annualisées pour la lisibilité et pour simplifier le mélange de données annuelles et trimestrielles. Le point 2025 (la dernière année) est donc un acquis sur les trimestres observés de l'année (ici 2 trimestres sur 4) suceptible de changer au fur et à mesure du temps. Il est possible en modifiant le code de produire un graphique trimestriel ou trimestriel lissé, à votre convenance.

```{r}
#| label: fig-psalcnc
#| fig-asp: 1
#| fig-cap: Non salarisation, part des salaires dans la VA nette, comptes de branches

champs  <- c("md" = "marchand", 
             "mdhifi" = "marchand hors immobilier et services financiers",
            "mdhfi"= "marchand hors services financiers", 
            "mdhi"= "marchand hors imm.", 
            "tb" = "Toutes branches (marchandes et non marchandes)")
naq <- source_data("vaq.r")$naa |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)} 
    {champs[champ]}
    Rémunérations (y.c. les non salariés) dans la VAN : {round(psal*100,1)}%
    Rémunérations (sans les non salariés) dans la VAN : {round(100*psalnc,1)}%")) |>
  mutate(geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE")))

date <- sourcoise::sourcoise_meta("vaq.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

annot <-  tribble(
    ~time, ~psal, ~label, ~geo, ~champ,
    "1996-01-01", .89, "Branches marchandes hors immobilier et finance", "DE", "mdhifi",
    "1996-01-01", .61, "Branches marchandes et non marchandes", "DE", "tb") |> 
  mutate(time = as.Date(time),
         geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE")))

labels_champ = c(tb = "Ttes branches", md="Marchand", 
                 mdhifi = "Marchand hors imm.&fin.",
                 mdhi = "Marchand hors imm.")

data <- naq |> 
  filter(champ %in% c("tb", "mdhi")) |> 
  select(time, geo, champ, psal, psalnc) |> 
  pivot_longer(c(psal, psalnc), names_to = "concept") |> 
  mutate(
    tooltip2 = ifelse(concept=="psal", 
                      "Part des salaires dans la VAN, non corrigée de la non salarisation",
                      "Part des salaires dans la VAN, corrigée de la non salarisation"))

psal <- ggplot(data) +
  aes(x=time, col = geo) +
  scale_alpha_manual(
    values = c(tb=.75, md=.75, mdhi = 1),
    labels = labels_champ,
    name = NULL) +
  scale_linetype_manual(
    values = c(tb="11", md="solid", mdhi ="solid"),
    labels = labels_champ,
    name = NULL) +
  scale_linewidth_manual(
    values = c(psal=.5, psalnc=0.2),
    labels = c(psal="Corrigé de la non salarisation", psalnc="Non corrigé"),
    name = NULL) +
  geom_ribbon(
    data = naq |> filter(champ %in%c("mdhi", "tb")),
    aes(ymin = psalnc, ymax = psal, fill = geo, group = champ), 
        color = NA, alpha=0.1, show.legend = FALSE) +
  geom_line_interactive( 
    aes(y=value, linetype = champ, linewidth = concept, alpha = champ,
        tooltip = tooltip2)) +
  geom_point_interactive(
    data = naq |> filter(champ == "mdhi"),
    aes(y=psal, tooltip = tooltip, data_id = time, fill = geo),
    size = 1, stroke = 0.2, shape = 21, color = "white",
    hover_nearest = TRUE, show.legend=FALSE) +
#  geom_marquee(
#    data = annot, hjust = 0, 
#    aes(label = label),  size = 6, size.unit = "pt", show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d ) +
  guides( fill = "none", color = "none",
          linewidth = guide_legend(ncol = 1),
          alpha = guide_legend(ncol = 1), 
          linetype = guide_legend(ncol = 1)) + 
  scale_y_continuous(labels = scales::label_percent(1), 
                     breaks = scales::pretty_breaks(3)) +
  scale_color_pays(format = "eurostat") +
  thm +
  theme(
    legend.position = "bottom",
    legend.justification = c(0.5, 0) ) +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}.",
    code =  "github.com/xtimbeau/travail/vaq.r",
    champ = "Branches marchandes et non marchandes (en léger et pointillé) et branches marchandes hors services immobiliers et financiers (L et K dans la NACE r2) (en plein).",
    note = "La CCF provient des comptes annuels, jusqu'en 2023 ou 2024 selon les pays, extrapolée au delà.")

girafy(psal, 1.5)
```

La correction de la non salarisation, en imputant une masse salariale pour les entrepreneurs individuels, augmente la part des salaires. La correction n'est pas constante dans le temps (c'est particulièrement fort pour la France) ni dans l'espace (la correction est très forte en Italie). La correction est plus importante lorsqu'on se limite aux branches marchandes hors services immobiliers et services financiers, sauf aux Pays-Bas.

```{r}
#| label: fig-psalnetbrut
#| fig-asp: 1
#| fig-cap: Part des salaires dans la VA nette et brute, comptes de branches

champs  <- c("md" = "marchand",
            "mdhifi" = "marchand hors immobilier et services financiers",
            "mdhfi"= "marchand hors services financiers", 
            "tb" = "Toutes branches (marchandes et non marchandes)")
naq <- source_data("vaq.r")$naa |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)} 
    {champs[champ]}
    Rémunérations (y.c. les non salariés) dans la VAN : {round(psal*100,1)}%
    Rémunérations (sans les non salariés) dans la VAB : {round(100*psalb,1)}%")) |>
  mutate(geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE")))

date <- sourcoise::sourcoise_meta("vaq.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

annot <-  tribble(
    ~time, ~psal, ~label, ~geo, ~champ,
    "1996-01-01", .89, "Branches marchandes hors immobilier et finance", "DE", "mdhifi",
    "1996-01-01", .61, "Branches marchandes et non marchandes", "DE", "tb") |> 
  mutate(time = as.Date(time),
         geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE")))

data <- naq |>
  select(geo, time, champ, psal, psalb) |> 
  filter(champ %in% c("tb", "mdhi")) |> 
  pivot_longer(c(psal, psalb), names_to = "concept") |> 
  mutate(
    tooltip2 = glue("{ifelse(concept=='psal', 'VA nette', 'VA brute')}")
  )

psal <- ggplot() +
  aes(x=time,  col = geo) +
  scale_alpha_manual(
    values = c(psalb=.25, psal = 1),
    labels = c(psal="VA nette", psalb="VA brute"),
    name = NULL) +
  scale_linetype_manual(
    values = c(tb="11", mdhi ="solid"),
    labels = labels_champ,
    name = NULL) +
  scale_linewidth_manual(
    values = c(psal=.5, psalb=.25),
    labels = c(psal="VA nette", psalb="VA brute"),
    name = NULL) +
  geom_ribbon(
     data = naq |> filter(champ %in% c("tb", "mdhi")),
     aes(ymin = psalb, ymax = psal, fill = geo, group = champ), 
     color = NA, alpha=0.1, show.legend = FALSE) +
  geom_line_interactive( 
    data = data,
    aes(y=value, linetype = champ, linewidth = concept, alpha = concept,
        group = interaction(geo, champ, concept),
        tooltip = tooltip2,
        data_id = time)) +
   geom_point_interactive(
     data = naq |> filter(champ == "mdhi"),
     aes(tooltip = tooltip, data_id = time, fill = geo, y=psal),
     size = 1, stroke = 0.2, shape = 21, color = "white",
     hover_nearest = TRUE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d ) +
  scale_y_continuous(labels = scales::label_percent(1),
                     breaks = scales::pretty_breaks(3)) +
  scale_color_pays(format = "eurostat") +
  thm +
  guides(fill = "none", color = "none") +
  theme(
    legend.position = "bottom",
    legend.justification = c(.5, 0) ) +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}.",
    code =  "github.com/xtimbeau/travail/vaq.r",
    champ = "Branches marchandes et non marchandes (en léger et pointillé) et branches marchandes hors services immobiliers et financiers (L et K dans la NACE r2) (en plein)")

girafy(psal, 1.5)
```

La notion de part des salaires dans la valeur ajoutée nette consiste à réduire le démominateur (la valeur ajoutée) de la consommation de capital fixe. Cela augmente donc le ratio. Cependant, cette correction n'est pas constante dans le temps (comme en France, en Espagne ou en Belgique). Comme on peut le voir sur le @fig-psalcompote, la variance entre les pays est plus basse pour la notion brute (non corrigé de la CCF) que nette. Pour les branches marchandes hors services immobiliers et services immobiliers, le classement entre pays est marginalement modifié, la Belgique ayant une part des salaires nette pus élevée que l'Allemagne, alors que sa part brute est plus faible qu'en Allemagne. Pour les autres pays, le classement est indentique (La France a la part la plus haute et les Pays-Bas plus faible).

```{r}
#| label: fig-psalcompote
#| fig-asp: 1.25
#| fig-cap: Tous concepts, comparaison entre pays

data <- naq |> 
  filter(time>="1995-01-01") |>
  select(geo, time, champ, psal, psalnc, psalb, psalncb) |> 
  pivot_longer(c(psal, psalnc, psalb, psalncb)) |> 
  mutate(name = factor(name, c("psal", "psalb", "psalnc", "psalncb")),
         champ = factor(champ, c("tb", "md", "mdhi", "mdhfi", "mdhifi")))

strips_name <- c(psal = "Nette, avec n.s.",
                psalnc = "Nette, sans n.s.",
                psalb = "Brute, avec n.s.",
                psalncb = "Brute, sans n.s.")
strips_champ <- c(tb = "Ttes branches",
                md = "Marchand",
                mdhi = "hors imm.",
                mdhfi = "hors fin.",
                mdhifi = "hors imm.&fin.")

gg <- ggplot(data) +
  aes(x=time, y = value, color = geo) + 
  geom_line_interactive(
    aes(tooltip = lbl(geo), data_id = geo),
    linewidth = 0.25,
    show.legend = FALSE, hover_nearest = TRUE) +
  theme_ofce(
    strip.text = element_marquee(size=rel(0.6)),
    axis.text = element_marquee(size=rel(0.6))
  ) +
  facet_grid(rows=vars(champ), cols = vars(name),
             labeller = labeller(name= strips_name, champ = strips_champ)) + 
  scale_y_continuous(labels = scales::label_percent(1),
                     breaks = scales::breaks_pretty(n=3)) +
  scale_ofce_date(
    labels = date1d
    ) +
  ylab("% de la VA") +
  scale_color_pays("eurostat") +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}.",
    code =  "github.com/xtimbeau/travail/vaq.r")

girafy(gg)
```

## Part des salaires dans la valeur ajoutée, comptes d'agents

Les comptes d'agents (ou de secteurs institutionnels) permettent une analyse plus simple, parce qu'ils permettent de distinguer les seules entreprises non financières. Cela évite d'avoir à prendre en compte les non salariés, cela exclue les services immobiliers produits par les ménages. C'est donc une analyse sur un champ économique plus strict (au sens de la forme légale des entités considérées). La notion d'impôt sur les sociétés est aussi mieux définie et le stock de capital productif est mieux connu du fait de l'obligation légale de déclaration des comptes des entreprises.

Malheureusement, comme identifié par l'INSEE, la pratique des instituts nationaux européens n'est pas conforme à celle de l'INSEE. Par exemple, en Allemagne, le secteur S11 inclut les quasi-sociétés et les entrepreneurs individuels. La normalisation des concepts est par ailleurs peu probable dans le futur, puisqu'elle est liée aux pratiques administratives.

Comme pour les graphiques précédents, les données trimestrielles sont annualisées (pour éliminer la variabilité trimestrielle qui nuit à la lisibilité et qui n'a pas beaucoup de sens). En trait pointillé, on représente la part de la valeur ajoutée dans les branches marchandes hors immobilier et corrigée de la non salarisation pour mesurer la différence des concepts.

```{r}
#| label: fig-s11psal
#| fig-cap: Part des salaires dans la VA, SNF, comptes d'agents
#| fig-asp: 1

snfq <- source_data("snf_ratio.r") |> 
  pluck("snfq") |>
  filter(sector == "S11" ) |> 
  mutate(year = floor_date(time, "year")) |> 
  select(-starts_with("s_adj_"), -time) |> 
  group_by(geo, year, sector) |> 
  summarize(across(everything(), ~sum(.x)/n()*4),
            .groups = "drop") |> 
  rename(time = year) |> 
  mutate(
    van = B1N,
    vab = B1G,
    msa = D1,
    psal = D1/B1N,
    psalb = D1/B1G,
    div = (D42)/B1N,
    divb = (D42)/B1G,
    isp = (D5+D2+D3)/B1N,
    tp = (B1N-D1-D5-D2-D3)/B1N ) |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)}
    Impôts net de subvention dans la VAN : {round(100*isp,1)}%
    Rémunérations dans la VAN : {round(psal*100,1)}%
    Rémunérations dans la VAB : {round(psalb*100,1)}%
    Profits nets (d'IS, taxes et subvention) dans la VAN : {round(tp*100,1)}%
    Dividendes nets dans la VAN : {round(div*100,1)}%")) |> 
  mutate(geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE"))) |> 
  filter(time>= "1995-01-01")

date <- sourcoise::sourcoise_meta("snf_ratio.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")
naq_a <-  naq |> 
  filter(champ == "mdhifi") |> 
  select(geo, time, psal_branche  = psal, psalb_branche = psalb)
data <- snfq |> 
  select(geo, time, psal_snf = psal, psalb_snf = psalb) |> 
  left_join(naq_a, by = c("geo", "time")) |> 
  pivot_longer(starts_with("psal")) |> 
  separate(name, into = c("concept", "champ")) |> 
  filter(time>="1995-01-01", !(concept=="psalb"&champ=="branche")) |> 
  mutate(
    tooltip2 = glue("Valeur ajoutée {ifelse(concept=='psal', 'nette', 'brute')}; {ifelse(champ=='snf', 'SNF', 'branches marchandes hors imm.&fin.')}") )

psnf <- ggplot(data) +
  aes(x=time,  col = geo) +
  scale_alpha_manual(
    values = c(psal = 1, psalb=0.5),
    labels = c(psal = "VA nette", psalb="VA brute"),
    name = NULL)+
  scale_linetype_manual(
    values = c(snf = "solid", branche="11"),
    labels = c(branche = "Branches non marchandes hors imm.&fin.", snf = "SNF"),
    name  = NULL) +
  scale_linewidth_manual(
    values = c(psal = .5, psalb=0.2),
    labels = c(psal = "VA nette", psalb="VA brute"),
    name  = NULL)+
  geom_ribbon(
    data = snfq,
    aes(ymin = psalb, ymax =psal, fill = geo), alpha =0.1, color = NA) +
  geom_line_interactive(
    aes(y=value, linetype = champ, linewidth = concept, alpha = concept,
        group = interaction(champ, concept, geo),
      tooltip = tooltip2)) +
  geom_point_interactive(
     data = snfq,
     aes( y = psal, fill = geo,
        tooltip = tooltip, data_id = time),
        size = 1, stroke = 0.25, shape = 21, color = "white",
        hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
   labels = date1d ) +
  scale_y_continuous(labels = scales::label_percent(1)) +
  scale_color_pays(format = "eurostat") +
  thm +
  theme(
    legend.position = "bottom",
    legend.justification = c(0.5, 1),
    legend.direction = "horizontal",
    legend.spacing.y = unit(4, "pt") ) +
  guides(color = "none", fill = "none",
         linetype = guide_legend(ncol = 1),
         linewidth = guide_legend(order=1, ncol = 1),
         alpha = guide_legend(order=1, ncol = 1)) +
  ofce_caption(
    source = "Eurostat, comptes nationaux trimestriels d'agents ou de secteurs institutionels (nasq_10_nf_tr), téléchargés le {date}, calcul de l'auteur.",
    code =  "github.com/xtimbeau/travail/snf_ratio.r",
    champ = "Sociétés non financières (les définitions varient suivant les pays)")

girafy(psnf, 1.5)
```

```{r}
#| label: fig-s1112psal
#| fig-cap: Part des salaires dans la VA, SNF+SF, comptes d'agents
#| fig-asp: 1

snffq <- source_data("snf_ratio.r") |> 
  pluck("snfq") |> 
  mutate(year = floor_date(time, "year")) |> 
  select(-starts_with("s_adj_")) |> 
  group_by(geo, time, year) |> 
  summarize(across(-sector, ~sum(.x)),
            .groups = "drop") |> 
  group_by(geo, year) |> 
  select(-time) |> 
  summarize(across(everything(), ~sum(.x)/n()*4),
            .groups = "drop") |> 
  rename(time = year) |> 
  mutate(
    van = B1N,
    vab = B1G,
    msa = D1,
    psal = D1/B1N,
    psalb = D1/B1G,
    div = (D42)/B1N,
    divb = (D42)/B1G,
    isp = (D5+D2+D3)/B1N,
    tp = (B1N-D1-D5-D2-D3)/B1N ) |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)}
    Impôts net de subvention dans la VAN : {round(100*isp,1)}%
    Rémunérations dans la VAN : {round(psal*100,1)}%
    Rémunérations dans la VAB : {round(psalb*100,1)}%
    Profits nets (d'IS, taxes et subvention) dans la VAN : {round(tp*100,1)}%
    Dividendes nets dans la VAN : {round(div*100,1)}%")) |> 
  mutate(geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE"))) |> 
  filter(time>= "1995-01-01")

date <- sourcoise::sourcoise_meta("snf_ratio.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")
naq_a <-  naq |> 
  filter(champ == "mdhi") |> 
  select(geo, time, psal_branche  = psal, psalb_branche = psalb)
data <- snfq |> 
  select(geo, time, psal_snf = psal, psalb_snf = psalb) |> 
  left_join(naq_a, by = c("geo", "time")) |> 
  pivot_longer(starts_with("psal")) |> 
  separate(name, into = c("concept", "champ")) |> 
  filter(time>="1995-01-01", !(concept=="psalb"&champ=="branche")) |> 
  mutate(
    tooltip2 = glue("Valeur ajoutée {ifelse(concept=='psal', 'nette', 'brute')}; {ifelse(champ=='snf', 'SNF', 'branches marchandes hors imm..')}") )

psnff <- ggplot(data) +
  aes(x=time,  col = geo) +
  scale_alpha_manual(
    values = c(psal = 1, psalb=0.5),
    labels = c(psal = "VA nette", psalb="VA brute"),
    name = NULL)+
  scale_linetype_manual(
    values = c(snf = "solid", branche="11"),
    labels = c(branche = "Branches non marchandes hors imm..", snf = "SNF&SF"),
    name  = NULL) +
  scale_linewidth_manual(
    values = c(psal = .5, psalb=0.2),
    labels = c(psal = "VA nette", psalb="VA brute"),
    name  = NULL)+
  geom_ribbon(
    data = snfq,
    aes(ymin = psalb, ymax =psal, fill = geo), alpha =0.1, color = NA) +
  geom_line_interactive(
    aes(y=value, linetype = champ, linewidth = concept, alpha = concept,
        group = interaction(champ, concept, geo),
      tooltip = tooltip2)) +
  geom_point_interactive(
     data = snfq,
     aes( y = psal, fill = geo,
        tooltip = tooltip, data_id = time),
        size = 1, stroke = 0.25, shape = 21, color = "white",
        hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
   labels = date1d ) +
  scale_y_continuous(labels = scales::label_percent(1)) +
  scale_color_pays(format = "eurostat") +
  thm +
  theme(
    legend.position = "bottom",
    legend.justification = c(0.5, 1),
    legend.direction = "horizontal",
    legend.spacing.y = unit(4, "pt") ) +
  guides(color = "none", fill = "none",
         linetype = guide_legend(ncol = 1),
         linewidth = guide_legend(order=1,ncol = 1),
         alpha = guide_legend(order=1,ncol = 1)) +
  ofce_caption(
    source = "Eurostat, comptes nationaux trimestriels d'agents ou de secteurs institutionels (nasq_10_nf_tr), téléchargés le {date}, calcul de l'auteur.",
    code =  "github.com/xtimbeau/travail/snf_ratio.r",
    champ = "Sociétés non financières et financières (les définitions varient suivant les pays)")

girafy(psnff, 1.5)
```

## Profits nets et dividendes dans les comptes d'agents

Les comptes des sociétés non financières permettent d’examiner d'autres éléments du compte. On affiche ici le profit net sur la valeur ajoutée nette, et le taux de dividendes nets sur la valeur ajoutée nette.

Les profits nets sont définis comme la valeur ajoutée nette de la consommation de capital fixe moins la rémunération des salariés, moins les taxes nettes des subventions moins l'impôt sur les sociétés :

$$
\Pi = B1G - P51C - D1 - (D2-D3) - D5
$$

Les dividendes sont la ligne \$D42\$ nette de ce qui est payé et reçu par le secteur S11.

```{r}
#| label: fig-profits
#| fig-cap: Profits nets dans la VA, comptes de secteur
#| fig-asp: 1

data <- snfq |> 
  filter(time >= "1995-01-01") |> 
  select(time, geo, tp, div) |> 
  pivot_longer(c(tp, div)) |> 
  mutate(tooltip2 = glue("{ifelse(name=='tp', 'Profits nets sur VAN, SNF', 'Dividendes nets sur VAN, SNF' )}")) |> 
  mutate(name = factor(name, c("tp","div")))

pprofit <- ggplot(data) +
  aes(x=time, col = geo) +
  scale_linewidth_manual(
    values = c(tp = 0.5, div = 0.25), 
    labels = c(tp = "Profits nets", div = "Dividendes"), 
    name = NULL) +
  scale_alpha_manual(
    values = c(tp = 1, div = 0.5),
    labels = c(tp = "Profits nets", div = "Dividendes"), 
    name = NULL) +
  geom_line_interactive(
     aes( y=value, linewidth = name, alpha = name, tooltip = tooltip2),
     hover_nearest = TRUE) +
  geom_point_interactive(
    data = snfq,
    aes(fill = geo, y = tp,
        tooltip = tooltip, data_id = time),
        size = 1, stroke = 0.2, shape = 21, color = "white",
        hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
   labels = date1d ) +
  scale_y_continuous(labels = scales::label_percent(1)) +
  scale_color_pays(format = "eurostat") +
  thm +
  theme(legend.position = c(0.35, 0.95),
        legend.justification = c(0, 1)) +
  guides(color = "none", fill = "none") +
  ofce_caption(
    source = "Eurostat, comptes nationaux trimestriels de secteur (nasq_10_nf_tr), téléchargés le {date}, calcul de l'auteur.",
    code =  "github.com/xtimbeau/travail/snf_ratio.r",
    champ = "Sociétés non financières (les définitions varient suivant les pays)")

girafy(pprofit, 1.5)
```

On peut rapporter ces notions aux éléments qui viennent du compte de capital. Le premier concept est le profit rapporté au stock de capital physique (tel que valorisé dans la comptabilité nationale, c'est-à-dire à la valeur de remplacement et au prix de marché). Malheureusement, à part la France, aucun pays dans notre échantillon ne diffuse ces données sur Eurostat.

On rapporte également à une notion financière, à savoir la valeur nette des actions au passif des comptes d'entreprises. Les conventions de valorisation des actions non côtées sont délicates et difficiles à suivre d'un pays à l'autres. On choisit ici d'augmenter ces actions de la valeur nette résiduelle des entreprises non financières ($BF90$). On a donc :

$$
\begin{align}
r_{productif} & = \frac{B2N-D5}{N1N+N2N} \\
r_{financier} & = \frac{B2N-D5}{F51+F52+BF90}
\end{align}
$$

On obtient le graphe suivant :

```{r}
#| label: fig-tprofit
#| fig-cap: Rendements du capital, compte de secteur
#| fig-asp: 1

assetsnfi <- source_data("snf_ratio.r") |> 
  pluck("assetsnfi") |> 
  transmute(geo, time, phycap = N1N + N2N) |>
  mutate(geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE")))

assetsfi <- source_data("snf_ratio.r") |> 
  pluck("assetsfi") |> 
  select(geo, time, net_shares, net_shares_augmented) |>
  mutate(geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE")))

snfq_a <- snfq |> 
  filter(time >= "1995-01-01") |> 
  left_join(assetsfi, by = c("geo", "time")) |> 
  left_join(assetsnfi, by = c("geo", "time")) |> 
  mutate(rendphy = tp*B1N/phycap,
         rendshare = tp*B1N/net_shares,
         rendshareaug = tp*B1N/net_shares_augmented)

ptprofit <- ggplot(snfq_a) +
  aes(x=time, col = geo) +
  geom_line_interactive(
     aes(y = rendphy, 
         tooltip = "rendement physique, SNF"),
     show.legend=FALSE) +
 # geom_line_interactive(
 #     aes(y = rendshare, 
 #         tooltip = "Dividendes nets sur les fonds propres, SNF"),
 #     show.legend=FALSE, linewidth = 0.25) +
 geom_line_interactive(
     aes(y = rendshareaug, 
         tooltip = "rendement financier, SNF"),
     show.legend=FALSE, linewidth = 0.25) +
  geom_point_interactive(
     aes(fill = geo, y = rendshareaug,
        tooltip = tooltip, data_id = time),
        size = 1, stroke = 0.2, shape = 21, color = "white",
        hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% du stock de capital") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
   labels = date1d ) +
  scale_y_continuous(labels = scales::label_percent(1)) +
  scale_color_pays(format = "eurostat") +
  thm +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels de secteur (nasa_10_nf_tr), capital productif par branche (nama_10_nfa_bs) et comptes de patrimoine (naidsa_10_f_bs), téléchargés le {date}, calcul de l'auteur.",
    code =  "github.com/xtimbeau/travail/snf_ratio.r",
    champ = "Sociétés non financières (les définitions varient suivant les pays)")

girafy(ptprofit, 1.5)
```

## Profits nets dans les comptes de branche

## Au delà de l'Europe

L'accès aux données de l'OCDE est devenu particulièrement opaque, mais je m'en suis sorti. Il est possible d'utiliser des données de comptabilité nationale, au niveau de l'ensemble de l'économie (y compris donc les branches non marchandes et l'immobilier). La correction pour la non-salarisation est assurée par les données de l'Economic Outlook (avec une trimestrialisation ad hoc). Au lieu de la valeur ajoutée, on utilise le PIB, auquel on enlève la conosmmation de capital fixe (dans les données OCDE, il n'y a pas de données de CCF pour le Japon). Le concept de part des salaires n'est donc pas tout à fait le même que dans les autres analyses.

On obtient ce graphique :

```{r}
#| label: fig-psaloecd
#| fig-cap: "Part des salaries dans le PIN, données SNA de l'OCDE"
#| fig-asp: 1

data <- ofce::source_data("oecd.r") |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {date_trim(time)}
    Salaires dans le Produit Intérieur Net de la CCF : {round(100*psalaire,1)}%")) |> 
  mutate(geo = factor(geo, c("DE", "FR", "IT", "ES", "NL", "BE", "US", "UK", "JP")),
         q = quarter(time))

date <- sourcoise::sourcoise_meta("oecd.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

psaloecd <- ggplot(data |> filter(year(time)>=1995)) +
  aes(x=time, y=psalaire, col = geo) +
  geom_line_interactive(
    aes(tooltip = "Part des salaires dans le PIN, corrigée de la non salarisation"),
    show.legend=FALSE) +
  geom_point_interactive(
    data = ~.x |> group_by(geo) |> filter(q == last(q)) |> ungroup(),
    aes(tooltip = tooltip, data_id = time, fill = geo),
    size = .2, stroke = 0.1, shape = 21, color = "white",
    hover_nearest = TRUE, show.legend=FALSE) +
  ylab("En % du PIN") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1d
  ) +
  scale_y_continuous(labels = scales::label_percent(1)) +
  scale_color_pays(format = "eurostat") +
  thm +
  ofce_caption(
    source = "OECD, comptes nationaux, téléchargés le {date},
 calcul de l'auteur.",
    code =  "github.com/xtimbeau/travail/oecd.r",
    champ = "Toutes branches, y compris services immobiliers")

girafy(psaloecd, 1.5)
```

En revanche, Eurostat a un programme de coopération (avec l'OCDE) pour intégrer les données dans un même cadre.

On utilise ces données ([`naidsa_10_nf_tr`](https://ec.europa.eu/eurostat/databrowser/view/naidsa_10_nf_tr__custom_13241966/default/table?lang=en)) pour construire des indicateurs comparables en comparant des pays autres que ceux de la zone euro.

```{r}
#| label: fig-tprofithze
#| fig-cap: Part des salaires dans la valeur ajoutée, comptes de secteur, comparaisons internationales
#| fig-asp: 0.6

snfia <- source_data("snf_international.r") |> 
  pluck("snfia") |>
  mutate(
    vab = B1G,
    van = B1N,
    msa = D1,
    psal = D1/B1N,
    div = D42/B1N,
    isp = (D5+D2+D3)/B1N,
    tp = (B1N-D1-D5-D2-D3)/B1N,
    label_geo = eurostat::label_eurostat(geo,"geo",lang="fr")) |> 
  mutate(tooltip = glue(
    "<b>{label_geo}</b>
    {year(time)}
    Impôts net de subvention dans la VAN : {round(100*isp,1)}%
    Rémunérations dans la VAN : {round(psal*100,1)}%
    Profits nets (d'IS, taxes et subvention) dans la VAN : {round(tp*100,1)}%
    Dividendes nets dans la VAN : {round(div*100,1)}%")) |> 
  mutate(geo = factor(geo, c("EA20", "US", "UK", "JP", "CA", "CH"))) |> 
  filter(year(time)>=1995)

meta <- sourcoise::sourcoise_meta("snf_ratio.r")
date <- meta$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")
lbl_eurostat <- function(x) eurostat::label_eurostat(x, "geo", lang = "fr", custom_dic=c("EA20"= "Zone euro"))
psali <- ggplot(snfia) +
  aes(x=time, y=psal, col = geo) +
  geom_line_interactive(
    aes(tooltip = "Part des salaires dans la VAN"), show.legend=FALSE) +
  geom_point_interactive(
    aes(tooltip = tooltip, data_id = time, fill = geo),
    size = 1, stroke = 0.2, shape = 21, color = "white",
    hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl_eurostat) +
  scale_ofce_date(
    labels = date1d
  ) +
  scale_y_continuous(labels = scales::label_percent(1), limits = c(NA, 1)) +
  scale_color_pays(format = "eurostat") +
  thm +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (naidsa_10_nf_tr), téléchargés le {date},
 calcul de l'auteur.",
    code =  "github.com/xtimbeau/travail/snf_international.r",
    champ = "Sociétés non financières (S11, la définition peut varier d'un pays à l'autre)")

girafy(psali, 1.5)
```
