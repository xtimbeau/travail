---
title: "Une part des salaires dans la VA élevée en 2025 en France"
subtitle: "*Annexes*"
toc-title: "*Annexes*"
format: 
  wp-html:
    appendix-cite-as: false
authors-title: "Auteur"

bibliography: references.bib
---

```{r, include=FALSE}
ofce::init_qmd()

P6 <- source_data("R/nace.r")$pays1 
champs  <- c("md" = "Branches marchandes", 
             "mdhifi" = "Branches marchandes hors services immobilier et financiers (-KLOPQ)",
             "mdhi"= "Branches marchandes hors services immobiliers (-LOPQ)", 
             "mdhim"= "Branches marchandes hors imm. des ménages (-LmOPQ)", 
             "mdhfi"= "Branches marchandes hors services financiers (-KOPQ)", 
             "tb" = "Toutes branches (marchandes et non marchandes)")

champs_c  <- c("md" = "Marchandes", 
               "mdhifi" = "Marchandes hors imm. et fin.",
               "mdhi"= "Marchandes hors im.", 
               "mdhim"= "Marchandes hors imm. ménages", 
               "mdhfi"= "Marchandes hors fin.", 
               "tb" = "Toutes branches")

naq <- source_data("R/vaq.r")$naa |> 
  filter(geo %in% P6) |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)} 
    {champs[champ]}
    Part des salaires dans la VAN : {round(psalh*100,1)}%")) |>
  mutate(geo = factor(geo, P6))

options(
  ofce.tabsetize.pdf = "one",
  ofce.savegraph = TRUE )
```

## Derniers points connus {#a1}

```{r}
doms <- source_data("R/vaq.r")$dom
pays <- source_data("R/nace.r")$pays3
emp_dom <- source_data("R/naq10_e.r")$dom
assets_dom <- source_data("R/assets.r")$dom
meta <- sourcoise::sourcoise_meta("R/vaq.r")
date <- meta$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

```

::: {#tbl-data_trim}
```{r}

doms$snq_b1g |>
  rename(debb1gq = deb, finb1gq = fin) |>
  left_join(doms$snq_d1, by = "geo") |> 
  rename(debd1q = deb, find1q = fin) |> 
  left_join(emp_dom, by = "geo") |> 
  rename(debs = deb, fins = fin) |> 
  left_join(doms$sna, by="geo") |> 
  rename(deba = deb, fina = fin) |> 
  left_join(doms$b3g, by="geo") |> 
  rename(debb3g = deb, finb3g = fin) |> 
  left_join(doms$l68a, by = "geo") |> 
  rename(debl = deb, finl = fin) |> 
  left_join(assets_dom, by = "geo") |> 
  rename(debk = deb, fink = fin) |> 
  mutate(geo = factor(geo, pays)) |> 
  arrange(geo) |> 
  mutate(geo_lbl = lbl(geo),
         geo = countrycode::countrycode(geo, "eurostat", "iso2c")) |> 
  relocate(geo, geo_lbl) |> 
  gt() |> 
  fmt_flag(geo) |> 
  tab_spanner(label = md("**B1G**<br>trim., niveau 1<br>namq_10_a10"), columns = c(debb1gq, finb1gq)) |> 
  tab_spanner(label = md("**D1**<br>trim., niveau 1<br>namq_10_a10"), columns = c(debd1q, find1q)) |> 
  tab_spanner(label = md("**SAL, NSAL**<br>an., niveau 2<br>nama_10_a64_e"), columns = c(debs, fins)) |> 
  tab_spanner(label = md("**P51C, D29x39, D51**<br>an., niveau 1<br>nama_10_a64"), columns = c(deba, fina)) |> 
  tab_spanner(label = md("**B3G**<br>an., niveau 0<br>nasa_10_nf_tr"), columns = c(debb3g, finb3g)) |> 
  tab_spanner(label = md("**Lm**<br>an., niveau 2<br>nama_10_a64"), columns = c(debl, finl)) |> 
  tab_spanner(label = md("**N11N**<br>an., niveau 2<br>nama_10_nfa_st"), columns = c(debk, fink)) |> 
  cols_label(geo="", geo_lbl = "") |> 
  cols_label_with(
    columns = starts_with(c("deb", "fin")), 
    fn = ~ifelse(str_detect(.x, "deb"), "de", "à")) |> 
  cols_align('center', -c(geo, geo_lbl)) |> 
  cols_align('left', c(geo, geo_lbl))  |> 
  opt_interactive() |> 
  tab_options(table.font.size = 11) |> 
  cols_width(
      geo ~ px(20),
      geo_lbl ~ px(90),
      everything() ~ px(65)) |> 
  tab_source_note(md(glue("*Note* : données téléchargées sur le site d'Eurostat (package eurostat v4.0.0) le {date}, telles que publiées par Eurostat. Les instituts nationaux peuvent mettre à disposition plus de données non (encore ?) prises en compte par Eurostat. Le niveau 1 compte 21 branches dont 19 marchandes. Le niveau 2 compte jusqu'à 99 branches, 47 sont utilisées pour les comptes de stock de capital productif."))) |> 
  my_tab_options()
```

Premiers et derniers points connus par pays et par variables
:::

## CCF et actifs dans les différents pays {#a2}

::: {#fig-ccf}
```{r, results="asis"}
#| fig-asp: 0.85
naa <- source_data("R/vaq.r")$naaa |> 
  filter(geo %in% P6) |> 
  mutate(
    ccf = (vab-van)/vab,
    ccfina = (vab-van)/assets,
    assetsinva = assets/vab) |> 
  mutate(tooltip = glue(
    "<b>{lbl(geo)}</b>
    {year(time)} 
    {champs[champ]}
    CCF dans la VAN : {round(ccf*100,1)}%
    CCF sur actifs productifs : {round(ccfina*100,1)}%
    actifs productifs sur VAB : {round(assetsinva*100,1)}%")) |>
  mutate(geo = factor(geo, P6))

date <- sourcoise::sourcoise_meta("R/vaq.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

labels_champ = c(tb = "Ttes branches", md="Marchand", mdhifi = "Marchand-LK",
                 mdhim = "Marchand-Lm",
                 mdhi = "Marchand-L")
ilc <- set_names(names(labels_champ), labels_champ)

ccfs <- imap(
  ilc,
  ~ggplot(naa |> filter(champ == .x)) +
    aes(x=time, y=ccf, col = geo, group = geo) +
    geom_line(color = "grey80", layout = "fixed", linewidth = 0.2) +
    geom_line(linewidth= 0.5) +
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = geo),
      size = 1, stroke = 0.2, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1 ) +
  guides( fill = "none", color = "none",
          linetype = guide_legend(nrow = 1),
          alpha = guide_legend(nrow = 1)) + 
  scale_y_continuous(
    labels = scales::label_percent(1), 
                     breaks = scales::pretty_breaks(5),
                     limits = c(0, 0.25),
    oob = scales::oob_keep) +
  scale_color_pays(format = "eurostat") +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}, code à github.com/xtimbeau/travail/R/vaq.r.",
    champ = "Branches marchandes {.y}.",
    note = "La CCF provient des comptes annuels, jusqu'en 2023 ou 2024 selon les pays (voir tableau A1). Les traits colorés correspondent à chaque pays, les traits fins gris rappellent les autres pays.") ) 

tabsetize(ccfs, 1.5, active = 5)
```

CCF dans la valeur ajoutée
:::

::: {#fig-ccfina}
```{r, results="asis"}
#| fig-asp: 0.85

ccfsina <- imap(
  ilc,
  ~ggplot(naa |> filter(champ == .x) |> drop_na(ccfina)) +
    aes(x=time, y=ccfina, col = geo, group = geo) +
    geom_line(color = "grey80", layout = "fixed", linewidth = 0.2) +
    geom_line()+
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = geo),
      size = 1, stroke = 0.2, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% des actifs") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1 ) +
  guides( fill = "none", color = "none",
          linetype = guide_legend(nrow = 1),
          alpha = guide_legend(nrow = 1)) + 
  scale_y_continuous(
    labels = scales::label_percent(1), 
                     breaks = scales::pretty_breaks(5),
                     limits = c(0, 0.2)) +
  scale_color_pays(format = "eurostat") +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e) et actifs productifs ((nama_10_nfa_bs)), téléchargés le {date}, code à github.com/xtimbeau/travail/R/vaq.r.",
    champ = "Branches marchandes {.y}.",
    note = "Les actifs sont les actifs productifs. Les traits colorés correspondent à chaque pays, les traits fins gris rappellent les autres pays.") ) 

tabsetize(ccfsina, 1.25, active = 5)
```

CCF rapportée aux actifs
:::

::: {#fig-assetva}
```{r, results="asis"}
#| fig-asp: 0.85

ccfsina <- imap(
  ilc,
  ~ggplot(naa |> filter(champ == .x) |> drop_na(ccfina)) +
    aes(x=time, y=assetsinva, col = geo, group = geo) +
    geom_line(color = "grey80", layout = "fixed", linewidth = 0.2) +
    geom_line()+
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = geo),
      size = 1, stroke = 0.2, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
  ylab("% de la VA") + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl) +
  scale_ofce_date(
    labels = date1 ) +
  guides( fill = "none", color = "none",
          linetype = guide_legend(nrow = 1),
          alpha = guide_legend(nrow = 1)) + 
  scale_y_continuous(
    labels = scales::label_percent(1), 
                     breaks = scales::pretty_breaks(5),
                     limits = c(0, NA)) +
  scale_color_pays(format = "eurostat") +
  ofce_caption(
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}, code à github.com/xtimbeau/travail/R/vaq.r.",
    champ = "Branches marchandes {.y}.",
    note = "La CCF provient des comptes annuels, jusqu'en 2023 ou 2024 selon les pays, extrapolée au delà (voir tableau A1). Les traits colorés correspondent à chaque pays, les traits fins gris rappellent les autres pays.") ) 

tabsetize(ccfsina, 1.25, active = 5)
```

Actifs productifs sur VAB
:::

## Différents concepts et champs de part des salaires {#a3}

::: {#fig-psalcompote}
```{r}
#| fig-asp: 1.4

data <- naq |> 
  filter(geo %in% P6) |> 
  filter(time>="1995-01-01", champ %in% c("tb", "md", "mdhi")) |>
  select(geo, time, champ, psalh, psal, psalnc, psalhb, psalb, psalncb) |> 
  pivot_longer(c(psalh, psal, psalnc, psalhb, psalb, psalncb)) |> 
  mutate(name = factor(name, c("psalh", "psal", "psalnc",  "psalhb", "psalb", "psalncb")),
         champ = factor(champ, c("tb", "md", "mdhi", "mdhim", "mdhimfi", "mdhfi", "mdhifi")))

strips_name <- c(psal = "Nette\neffectif",
                 psalh = "Nette\nrev. mixte",
                 psalnc = "Nette\nsalariés seuls",
                 psalb = "Brute\neffectif",
                 psalhb = "Brute\nrev. mixte",
                 psalncb = "Brute\nsalariés seuls")
strips_champ <- c(tb = "Ttes branches",
                  md = "Marchand",
                  mdhi = "hors imm.",
                  mdhim = "hors loy. imp.",
                  mdhimfi = "hors fin.&loy. imp.",
                  mdhfi = "hors fin.",
                  mdhifi = "hors imm.&fin.")

gg <- ggplot(data) +
  aes(x=time, y = value, color = geo, linewidth = geo) +
  scale_linewidth_manual(
    values = c(FR = 0.5, DE = 0.25, IT = 0.25, NL = 0.25, BE = 0.25, ES = 0.25) ) +
  geom_line_interactive(
    aes(tooltip = lbl(geo), data_id = geo),
    show.legend = FALSE, hover_nearest = TRUE) +
   facet_grid(cols=vars(champ), rows = vars(name),
              scales = "free_y",
             labeller = labeller(name= strips_name, champ = strips_champ)) + 
  scale_y_continuous(labels = scales::label_percent(1),
                     breaks = scales::breaks_pretty(n=3)) +
  scale_ofce_date(
    labels = date1 ) +
  ylab("% de la VA") +
  scale_color_pays("eurostat") +
  ofce_caption(
    note = "L'échelle des *y* varie suivant les lignes",
    source = "Eurostat, comptes nationaux annuels (nama_10_a64, nama_10_a64_e),
 comptes nationaux trimestriels (namq_10_a10), téléchargés le {date}, code à github.com/xtimbeau/travail/R/vaq.r.")

girafy(gg, 1.25)
```

Part des salaires dans la VA, tous concepts, comparaison entre pays
:::

::: {#tbl-rang}
```{r, results="asis"}

corrections <- c(psal = "effectif",
                 psalh = "rev. mixte",
                 psalnc = "salariés seuls",
                 psalb = "effectif",
                 psalhb = "rev. mixte",
                 psalncb = "salariés seuls")

tt <- imap(strips_champ, ~{
  source_data("R/vaq.r")$naa |> 
    filter(time == "2024-01-01", champ == .y) |> 
    drop_na(psalh) |> 
    select(geo, psalh, psal, psalnc, psalhb, psalb, psalncb) |> 
    arrange(desc(psalh)) |> 
    pivot_longer(c(psalh, psal, psalnc, psalhb, psalb, psalncb)) |>
    group_by(name) |> 
    mutate(t = str_c(round(value*100,1), "% (", rank(-value),")"),
           geo_lbl = lbl(geo),
           geo = countrycode(geo, "eurostat", "iso2c")) |> 
    rename(v = value) |> 
    arrange(geo) |> 
    pivot_wider(names_from = name, values_from = c(v, t) ) |> 
    relocate(geo, geo_lbl) |> 
    gt() |> 
    cols_hide(starts_with("v_")) |> 
    tab_spanner(label = "dans la VA nette", columns = c(t_psal, t_psalh, t_psalnc)) |> 
    tab_spanner(label = "dans la VA brute", columns = c(t_psalb, t_psalhb, t_psalncb)) |> 
    cols_label_with(starts_with("t_"), ~corrections[[str_remove(.x, "t_")]] ) |> 
    gt::fmt_flag(geo) |> 
    fmt_percent(starts_with("value"),decimals = 1) |> 
    cols_label(geo = "", geo_lbl = "") |> 
    opt_interactive() |> 
    fmt_missing() |> 
    tab_options(table.font.size = 12) |> 
    cols_width(
      geo ~ px(20),
      geo_lbl ~ px(90),
      everything() ~ px(85)
    )
})

names(tt) <- strips_champ

tabsetize(tt, active = 3)
```

Part des salaires dans la VA et rang en 2024, différents concepts
:::

::: {#tbl-evol}
```{r, results="asis"}

corrections <- c(psal = "effectif",
                 psalh = "rev. mixte",
                 psalnc = "salariés seuls",
                 psalb = "effectif",
                 psalhb = "rev. mixte",
                 psalncb = "salariés seuls")

tt <- imap(strips_champ, ~{
  source_data("R/vaq.r")$naa |> 
    filter(time%in%c("2024-01-01", "1998-01-01"), champ == .y) |> 
    mutate(year = str_c("y",year(time))) |> 
    select(geo, year, psalh, psal, psalnc, psalhb, psalb, psalncb) |> 
    arrange(desc(psalh)) |> 
    pivot_longer(c(psalh, psal, psalnc, psalhb, psalb, psalncb)) |>
    pivot_wider(names_from = year, values_from = value) |>
    transmute(
      geo, name, 
      d=y2024-y1998) |> 
    group_by(name) |> 
    transmute(
      geo = countrycode(geo, "eurostat", "iso2c"),
      geo_lbl = countrycode(geo, "iso2c", "country.name.fr"),
      d) |> 
    arrange(geo) |> 
    pivot_wider(names_from = name, values_from =  d ) |>
    drop_na(psalh) |>
    relocate(geo, geo_lbl, psalh, psal, psalnc, psalhb, psalb, psalncb) |> 
    arrange(desc(psalh)) |> 
    gt() |> 
    tab_spanner(label = "dans la VA nette", columns = c(psalh, psal, psalnc)) |> 
    tab_spanner(label = "dans la VA brute", columns = c(psalhb, psalb, psalncb)) |> 
    cols_label_with(starts_with("psal"), ~corrections[[.x]] ) |> 
    gt::fmt_flag(geo) |> 
    fmt_percent(starts_with("psal"),decimals = 1, force_sign = TRUE) |> 
    cols_label(geo = "", geo_lbl = "") |> 
    opt_interactive() |> 
    fmt_missing() |> 
    tab_options(table.font.size = 12) |> 
    cols_width(
      geo ~ px(20),
      geo_lbl ~ px(90),
      everything() ~ px(100)
    )
})

names(tt) <- strips_champ

tabsetize(tt, active = 3)
```

Part des salaires dans la VA et rang évolution entre 2024 et 1998, différents concepts
:::

## Rémunération des non salariés {#a4}

::: {#fig-mixte}
```{r, results="asis"}
#| fig-asp: 1 
PA <- source_data("R/nace.r")$pays1 
anD <- source_data("R/annexeD.r") |> 
  mutate(
    reff = self/sal,
    reffh = selfh/salh,
    rb3g = b3g/d1, 
    rb3n = ifelse(geo=="FR", b3n/d1, 0.88*b3g/d1),
    rwpc = w,
    across(c(reff, reffh, rb3n), ~.x/reff, .names = "{.col}pc")) |> 
  relocate(geo, time, champ, starts_with("r")) |> 
  filter(geo %in% PA) |> 
  mutate(geo = factor(geo, PA),
         tooltip = glue(
         "<b>{lbl(geo)}</b>
         Part des non salaries, toutes branches, selon :
           - les effectifs : {round(reff*100, 1)}%
           - les heures travaillées : {round(reffh*100, 1)}%
           - le revenu (b3n/d1) : {round(rb3n*100, 1)}%
           - le revenu (équivalent) issu de EU-SILC : : {round(rb3n*100, 1)}"))

date <- sourcoise::sourcoise_meta("R/annexeD.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

data <- anD |> 
  filter(champ == "tb") |>
  select(geo, time, tooltip, reff, reffh, rb3n) |> 
  pivot_longer(-c(geo, time, tooltip), names_to = "concept") |> 
  mutate(
    concept = factor(concept, c("reff", "reffh", "rb3n")),
    principal = concept == "reffh") |> 
  filter(time>="1995-01-01")

datapc <- anD |> 
  filter(champ == "tb") |>
  select(geo, time, tooltip, reffpc, reffhpc, rb3npc, rwpc) |>
  rename_with(.fn = ~str_remove(.x, "pc$"), .cols = starts_with("r")) |> 
  pivot_longer(-c(geo, time, tooltip), names_to = "concept") |> 
  mutate(
    concept = factor(concept, c("reff", "reffh", "rb3n", "rw")),
    principal = concept== "rb3n") |> 
  filter(time>="1995-01-01")

labels <- c(reff = "Effectifs", reffh = "Heures", rb3n = "Revenu mixte", rw = "Revenu EU-SILC")

gD <-imap(
  list("Agrégé" = data, "Par tête" = datapc), 
  ~ ggplot(.x) +
  aes(x=time, y=value, col = geo, group = concept, 
      linewidth = concept, linetype = concept, alpha = concept) +
  geom_line()+
  geom_point_interactive(
    data = ~filter(.x, principal),
    aes(tooltip = tooltip, data_id = time, fill = geo),
    size = 1, stroke = 0.5, shape = 21, color = "white",
    hover_nearest = TRUE, show.legend=FALSE) +
  ylab(NULL) + xlab(NULL) +
  facet_wrap(vars(geo), ncol = 3, labeller = lbl, scales = "free_y") +
  scale_ofce_date(
    labels = date1 ) +
  scale_alpha_manual(
    values = c(reff = 0.75, reffh = 0.5, rb3n = 1, rw = 0.5),
    labels = labels,
    name = NULL) +
  scale_linewidth_manual(
    values = c(reff = 0.25, reffh = 0.5, rb3n = 0.75, rw =0.5),
    labels = labels,
    name = NULL) +
  scale_linetype_manual(
    values = c(reff = "solid", reffh = "11", rb3n = "solid", rw = "12"),
    labels = labels,
    name = NULL) +
  guides( 
    fill = "none", color = "none",
    linetype = guide_legend(nrow = 1),
    alpha = guide_legend(nrow = 1)) + 
  scale_y_continuous(
    labels = scales::label_percent(1), 
    breaks = scales::pretty_breaks(3)) +
  scale_color_pays(format = "eurostat") +
  ofce_caption(
    note = "Le graphique compare trois sources différentes, d'une part les effectifs (habituellement utilisé pour corriger de l anon salarisation), d'autre part le revenu mixte et enfin l'enquête EU-SILC. Les échelles de chaque pays sont ajustées et donc différentes.",
    source = "Eurostat, comptes nationaux annuels de secteur (nasa_10_nf_tr), emploi (nama_10_a64_e), EU-SILC (ilc_di05), téléchargés le {date}, code à github.com/xtimbeau/travail/R/annexeD.r.",
 champ = "Toutes branches.") )

tabsetize(gD, r = 1.5)
```

Différentes mesures du revenu des non salariés, comparaisons internationales
:::

::: {#fig-mixtefr}
```{r, results="asis"}
#| fig-asp: 0.7 
anD <- source_data("R/annexeD.r") |> 
  filter(geo == "FR", champ %in% c("tb", "md", "mdhi")) |> 
  mutate(
    reff = self/sal,
    reffh = selfh/salh,
    rb3n = b3n/d1,
    rb3npc = b3n/self/(d1/sal)) |> 
  relocate(geo, time, champ, starts_with("r")) |> 
  mutate(tooltip = glue(
         "<b>France</b>
         {champs[champ]} 
         Part des non salaries, selon :
           - les effectifs : {round(reff*100, 1)}%
           - les heures travaillées : {round(reffh*100, 1)}%
           - le revenu (b3n/d1) : {round(rb3n*100, 1)}%")) |> 
  select(time, champ, reff, reffh, rb3n, rb3npc, tooltip) |> 
  pivot_longer(c(reff, reffh, rb3n, rb3npc), names_to = "concept") |> 
  mutate(principal = concept == "md")

date <- sourcoise::sourcoise_meta("annexeD.r")$data_date |> ymd_hms() 
date <- stringr::str_glue("{day(date)}/{month(date)}/{year(date)}")

labels <- c(reff = "Effectifs", reffh = "Heures", rb3n = "Revenu mixte", rw = "Revenu EU-SILC")

gD2 <-imap(
  c("Effectifs" = "reff", "Heures" = "reffh", "Revenu mixte" = "rb3n", "Revenu mixte par tête" = "rb3npc"),   ~ {
    data <- anD |> 
    filter(concept == .x) |>
    select(time, champ, value, tooltip, principal) |> 
    mutate(
      champ = factor(champ, c("tb", "md", "mdhi")),
      principal = champ == "md") |> 
    filter(time>="1995-01-01")
  labels <- c(md = "Marchandes", 
              tb = "Toutes branches", 
              mdhi = "Marchandes hors immo.")
  ggplot(data) +
    aes(x=time, y=value, col = champ, group = champ, 
        linewidth = champ, linetype = champ) +
    cols4all::scale_color_discrete_c4a_cat(
      "tableau.10", name = NULL,
      labels = labels) +
    cols4all::scale_fill_discrete_c4a_cat("tableau.10") +
    geom_line()+
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = champ),
      size = 1, stroke = 0.5, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
  ylab(NULL) + xlab(NULL) +
  scale_ofce_date(
    labels = date1 ) +
  scale_linewidth_manual(
    values = c(tb = 0.25, md = 0.5, mdhi = 0.25),
    labels = labels,
    name = NULL) +
  scale_linetype_manual(
    values = c(tb = "11", md = "solid", mdhi = "solid"),
    labels = labels,
    name = NULL) +
  guides(fill = "none") + 
  scale_y_continuous(
    labels = scales::label_percent(1), 
    breaks = scales::pretty_breaks(3)) +
    theme(legend.direction = "horizontal") +
  ofce_caption(
    source = "INSEE, téléchargés le {date}, code à   github.com/xtimbeau/travail/R/annexeD.r.",
 champ = "voir légende") 
  })

tabsetize(gD2, r = 1.5)
```

Différentes mesures du revenu des non salariés en France
:::

## Part des salaires dans la VA, base 2020 et 2014 en France, 1949-2024 {#a5}

::: {#fig-psalfr49}
```{r, results="asis"}
#| fig-asp: 0.85

cn14 <- source_data("R/france CN 2014.R") |> 
  select(time, champ, psal, psalc, starts_with("na"))
cn20 <- source_data("R/france-melodi.r")$aggr |> 
  select(time, champ, psal = psalm)

champs  <- c("md" = "Marchand", 
             "mdhifi" = "Marchand hors immobilier et services financiers",
            "mdhi"= "Marchand hors services immobiliers", 
            "mdhfi"= "Marchand hors services financiers", 
            "tb" = "Toutes branches (marchandes et non marchandes)")

data <- full_join(cn14, cn20, by=c("time", "champ"), suffix = c(".14", ".20")) |>
  mutate(
    across(starts_with("na"), ~replace_na(.x, FALSE)),
    na = naccf | nab3g | nad29 | nad39,
    tooltip = glue(
      "<b>{year(time)}</b>
      Part des salaires dans la VAN, correction par le revenu mixte (voir note)
      CNA 2020 (b3g par branches): {round(psal.20*100,1)}%
      CNA 2014 (effectifs) : {round(psal.14*100,1)}%,
      CNA 2014 (ajusté sur b3g EI) : {round(psalc*100,1)}%" ) ) |> 
  pivot_longer(c(psal.20, psal.14, psalc))

psalE <- imap(
  c("Marchand" = "md",
    "Hors immo." = "mdhi", 
    "Hors  fi." = "mdhfi",
    "Hors immmo.&fin." = "mdhifi",
    "Marchand et non marchand" = "tb"),
  ~ggplot(data |> filter(champ == .x)) +
    aes(x=time, y=value, col = name, group = name, linetype = name) +
    geom_line() +
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = name),
      size = 1, stroke = 0.5, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
    ylab("% de la VA") + xlab(NULL) +
    scale_ofce_date(
      labels = date1 ) +
    guides( fill = "none") +
    theme(legend.direction = "horizontal") +
    scale_color_manual(
      values = c(psal.14 = bluish, psalc = redish, psal.20 = redish),
      name = NULL,
      labels = c(psal.14 = "CNA 2014 (effectifs)", 
                 psalc = "CNA 2014 (b3g EI)",
                 psal.20 = "CNA 2020 (b3g br., hybride avant 1978)"),
      aesthetics = c("color", "fill")) +
    scale_linetype_manual(
      values = c(psal.14 = "11", psalc = "11", psal.20 = "solid"),
      name = NULL,
      labels = c(psal.14 = "CNA 2014 (effectifs)",
                 psalc = "CNA 2014 (b3g EI)",
                 psal.20 = "CNA 2020 (b3g br., hybride avant 1978)") ) +
    scale_y_continuous(
      labels = scales::label_percent(1), 
      breaks = scales::pretty_breaks(5),
      limits = c(0.7, 0.95),
      oob = scales::oob_keep) +
    guides(linewidth = "none") +
    ofce_caption(
      source = "INSEE, comptes nationaux annuels base 2014 (de 2022) et base 2020 (de 2025), code à github.com/xtimbeau/travail/france CN 2014.r.",
      champ = "{champs[.x]}.",
      note = "La construction de la part des salaires de 1949 à 1978 demande la rétropolation de la CCF (P51C), des subventions (D29) et impôts à la production (D39) à partir de la valeur ajoutée brute ainsi que du revenu mixte à partir des effectifs salariés et non salariés. Pour la CN2020, le revenu mixte par branche est disponible à partir de 1978. Avant, la distinction n'est faite que pour le total des branches. On rétropole sur cette base. Dans la CN2014 on utilise la méthode effectif ou revenu mixte hybride.") ) 

tabsetize(psalE, r = 1.5, active = 2)

```

Part des salaires en France 1949-2025
:::

## Taux de rendement du capital productif en France, 1978-2024 {#a6}

::: {#fig-rfr78}
```{r, results="asis"}
#| fig-asp: 0.85

cn20 <- source_data("R/france-melodi.r")$aggr |> 
  select(time, champ, rb, rbm) |> 
  drop_na(rb)

champs  <- c("md" = "Branches marchandes", 
             "mdhifi" = "Branches marchandes hors services immobiliers et financiers",
            "mdhi"= "Branches marchandes hors services immobiliers", 
            "mdhfi"= "Branches marchandes hors services financiers", 
            "tb" = "Toutes branches (marchandes et non marchandes)")

data <- cn20 |>
  mutate(
    tooltip = glue(
      "<b>{year(time)}</b>
      Rendement du capital productif, 
      Correction par les effectifs : {round(rb*100,1)}%
      Correction par le revenu mixte : {round(rbm*100,1)}%" ) ) |> 
  pivot_longer(c(rb, rbm))

psalE <- imap(
  c("Marchand" = "md",
    "Hors immo." = "mdhi", 
    "Hors  fi." = "mdhfi",
    "Hors immmo.&fin." = "mdhifi",
    "Marchand et non marchand" = "tb"),
  ~ggplot(data |> filter(champ == .x)) +
    aes(x=time, y=value, col = name, group = name) +
    geom_line() +
    geom_point_interactive(
      aes(tooltip = tooltip, data_id = time, fill = name),
      size = 1, stroke = 0.5, shape = 21, color = "white",
      hover_nearest = TRUE, show.legend=FALSE) +
    ylab("% des actifs productifs") + xlab(NULL) +
    scale_ofce_date(
      labels = date1 ) +
    guides( fill = "none") +
    theme(legend.direction = "horizontal") +
    scale_color_manual(values = c(rb = bluish, rbm = redish),
                       aesthetics = c("color", "fill"),
                       name = NULL,
                       labels = c(rb = "Correction effectifs", rbm = "Correction revenu mixte")) +
    scale_y_continuous(
      labels = scales::label_percent(1), 
      breaks = scales::pretty_breaks(5),
      limits  = c(0,0.12),
      oob = scales::oob_keep) +
    ofce_caption(
      source = "INSEE, comptes nationaux annuels base 2020, code à github.com/xtimbeau/travail/france-melodi.r.",
      champ = "{champs[.x]}",
      note = "Le rendement du capital productif est défini comme le profit net de la CCF avant impôt sur les sociétés et après impôts et suvention à la production divisé par la valeur au coût de remplacement des actifs produits (N11N).") ) 

tabsetize(psalE, r = 1.5, active=2)

```

Taux de rendement du capital productif en France, 1978-2024
:::
